
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.7">
    
    
      
        <title>fmsignal - FMKit</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fmsignal-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="FMKit" class="md-header-nav__button md-logo" aria-label="FMKit">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            FMKit
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              fmsignal
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="FMKit" class="md-nav__button md-logo" aria-label="FMKit">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    FMKit
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../arch/" class="md-nav__link">
        The FMKit Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../manual_signal/" class="md-nav__link">
        User Manual - Signal
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
      
      <label class="md-nav__link" for="nav-4">
        Code Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Code Reference" data-md-level="1">
        <label class="md-nav__title" for="nav-4">
          <span class="md-nav__icon md-icon"></span>
          Code Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          fmsignal
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        fmsignal
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fmsignal" class="md-nav__link">
    fmsignal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.FMSignal" class="md-nav__link">
    FMSignal
  </a>
  
    <nav class="md-nav" aria-label="FMSignal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.__str__" class="md-nav__link">
    __str__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.align_to" class="md-nav__link">
    align_to()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.all_close_to" class="md-nav__link">
    all_close_to()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.amplitude_normalize" class="md-nav__link">
    amplitude_normalize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.construct_from_file" class="md-nav__link">
    construct_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.copy" class="md-nav__link">
    copy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.distance_to" class="md-nav__link">
    distance_to()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.filter" class="md-nav__link">
    filter()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.get_orientation" class="md-nav__link">
    get_orientation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.load_alignment_index" class="md-nav__link">
    load_alignment_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.load_from_file" class="md-nav__link">
    load_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.pertube_amplitude" class="md-nav__link">
    pertube_amplitude()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.pertube_amplitude_seg" class="md-nav__link">
    pertube_amplitude_seg()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.resize" class="md-nav__link">
    resize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.resize_segment" class="md-nav__link">
    resize_segment()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.save_alignment_index" class="md-nav__link">
    save_alignment_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.save_to_file" class="md-nav__link">
    save_to_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.shift_temporally" class="md-nav__link">
    shift_temporally()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.stretch_axis" class="md-nav__link">
    stretch_axis()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.swap_segment" class="md-nav__link">
    swap_segment()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.FMSignalDesc" class="md-nav__link">
    FMSignalDesc
  </a>
  
    <nav class="md-nav" aria-label="FMSignalDesc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalDesc.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalDesc.__str__" class="md-nav__link">
    __str__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalDesc.construct_from_meta_file" class="md-nav__link">
    construct_from_meta_file()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove" class="md-nav__link">
    FMSignalGlove
  </a>
  
    <nav class="md-nav" aria-label="FMSignalGlove">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.all_close_to" class="md-nav__link">
    all_close_to()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.construct_from_file" class="md-nav__link">
    construct_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.convert_axes_to_standard_glove" class="md-nav__link">
    convert_axes_to_standard_glove()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.convert_to_standard_glove" class="md-nav__link">
    convert_to_standard_glove()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.estimate_angular_states" class="md-nav__link">
    estimate_angular_states()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.estimate_linear_states" class="md-nav__link">
    estimate_linear_states()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.filter" class="md-nav__link">
    filter()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.load_from_buffer_raw" class="md-nav__link">
    load_from_buffer_raw()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.load_from_buffer_raw_internal" class="md-nav__link">
    load_from_buffer_raw_internal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.load_from_file" class="md-nav__link">
    load_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.pose_normalize" class="md-nav__link">
    pose_normalize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.prepare_trim_by_acc" class="md-nav__link">
    prepare_trim_by_acc()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.preprocess" class="md-nav__link">
    preprocess()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.save_to_buffer_raw" class="md-nav__link">
    save_to_buffer_raw()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.save_to_file" class="md-nav__link">
    save_to_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.trim" class="md-nav__link">
    trim()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap" class="md-nav__link">
    FMSignalLeap
  </a>
  
    <nav class="md-nav" aria-label="FMSignalLeap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.all_close_to" class="md-nav__link">
    all_close_to()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.construct_from_file" class="md-nav__link">
    construct_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.estimate_angular_states" class="md-nav__link">
    estimate_angular_states()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.estimate_linear_states" class="md-nav__link">
    estimate_linear_states()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.filter" class="md-nav__link">
    filter()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.fix_missing_samples" class="md-nav__link">
    fix_missing_samples()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.load_from_buffer_raw" class="md-nav__link">
    load_from_buffer_raw()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.load_from_buffer_raw_internal" class="md-nav__link">
    load_from_buffer_raw_internal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.load_from_file" class="md-nav__link">
    load_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.pose_normalize" class="md-nav__link">
    pose_normalize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.prepare_trim_by_velocity" class="md-nav__link">
    prepare_trim_by_velocity()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.preprocess" class="md-nav__link">
    preprocess()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.resample" class="md-nav__link">
    resample()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.rotate" class="md-nav__link">
    rotate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.save_to_buffer_raw" class="md-nav__link">
    save_to_buffer_raw()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.save_to_file" class="md-nav__link">
    save_to_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.translate" class="md-nav__link">
    translate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.trim" class="md-nav__link">
    trim()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate" class="md-nav__link">
    FMSignalTemplate
  </a>
  
    <nav class="md-nav" aria-label="FMSignalTemplate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate.all_close_to" class="md-nav__link">
    all_close_to()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate.construct_from_file" class="md-nav__link">
    construct_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate.construct_from_signals" class="md-nav__link">
    construct_from_signals()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate.load_from_file" class="md-nav__link">
    load_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate.save_to_file" class="md-nav__link">
    save_to_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.dtw" class="md-nav__link">
    dtw()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.dtw_c" class="md-nav__link">
    dtw_c()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.normalize_warping_path_a2to1" class="md-nav__link">
    normalize_warping_path_a2to1()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.warping_path_to_xy_sequences" class="md-nav__link">
    warping_path_to_xy_sequences()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../fmsignal_vis-reference/" class="md-nav__link">
        fmsignal_vis
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pyrotation-reference/" class="md-nav__link">
        pyrotation
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fmsignal" class="md-nav__link">
    fmsignal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.FMSignal" class="md-nav__link">
    FMSignal
  </a>
  
    <nav class="md-nav" aria-label="FMSignal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.__str__" class="md-nav__link">
    __str__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.align_to" class="md-nav__link">
    align_to()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.all_close_to" class="md-nav__link">
    all_close_to()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.amplitude_normalize" class="md-nav__link">
    amplitude_normalize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.construct_from_file" class="md-nav__link">
    construct_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.copy" class="md-nav__link">
    copy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.distance_to" class="md-nav__link">
    distance_to()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.filter" class="md-nav__link">
    filter()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.get_orientation" class="md-nav__link">
    get_orientation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.load_alignment_index" class="md-nav__link">
    load_alignment_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.load_from_file" class="md-nav__link">
    load_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.pertube_amplitude" class="md-nav__link">
    pertube_amplitude()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.pertube_amplitude_seg" class="md-nav__link">
    pertube_amplitude_seg()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.resize" class="md-nav__link">
    resize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.resize_segment" class="md-nav__link">
    resize_segment()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.save_alignment_index" class="md-nav__link">
    save_alignment_index()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.save_to_file" class="md-nav__link">
    save_to_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.shift_temporally" class="md-nav__link">
    shift_temporally()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.stretch_axis" class="md-nav__link">
    stretch_axis()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignal.swap_segment" class="md-nav__link">
    swap_segment()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.FMSignalDesc" class="md-nav__link">
    FMSignalDesc
  </a>
  
    <nav class="md-nav" aria-label="FMSignalDesc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalDesc.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalDesc.__str__" class="md-nav__link">
    __str__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalDesc.construct_from_meta_file" class="md-nav__link">
    construct_from_meta_file()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove" class="md-nav__link">
    FMSignalGlove
  </a>
  
    <nav class="md-nav" aria-label="FMSignalGlove">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.all_close_to" class="md-nav__link">
    all_close_to()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.construct_from_file" class="md-nav__link">
    construct_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.convert_axes_to_standard_glove" class="md-nav__link">
    convert_axes_to_standard_glove()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.convert_to_standard_glove" class="md-nav__link">
    convert_to_standard_glove()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.estimate_angular_states" class="md-nav__link">
    estimate_angular_states()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.estimate_linear_states" class="md-nav__link">
    estimate_linear_states()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.filter" class="md-nav__link">
    filter()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.load_from_buffer_raw" class="md-nav__link">
    load_from_buffer_raw()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.load_from_buffer_raw_internal" class="md-nav__link">
    load_from_buffer_raw_internal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.load_from_file" class="md-nav__link">
    load_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.pose_normalize" class="md-nav__link">
    pose_normalize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.prepare_trim_by_acc" class="md-nav__link">
    prepare_trim_by_acc()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.preprocess" class="md-nav__link">
    preprocess()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.save_to_buffer_raw" class="md-nav__link">
    save_to_buffer_raw()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.save_to_file" class="md-nav__link">
    save_to_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalGlove.trim" class="md-nav__link">
    trim()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap" class="md-nav__link">
    FMSignalLeap
  </a>
  
    <nav class="md-nav" aria-label="FMSignalLeap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.all_close_to" class="md-nav__link">
    all_close_to()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.construct_from_file" class="md-nav__link">
    construct_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.estimate_angular_states" class="md-nav__link">
    estimate_angular_states()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.estimate_linear_states" class="md-nav__link">
    estimate_linear_states()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.filter" class="md-nav__link">
    filter()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.fix_missing_samples" class="md-nav__link">
    fix_missing_samples()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.load_from_buffer_raw" class="md-nav__link">
    load_from_buffer_raw()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.load_from_buffer_raw_internal" class="md-nav__link">
    load_from_buffer_raw_internal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.load_from_file" class="md-nav__link">
    load_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.pose_normalize" class="md-nav__link">
    pose_normalize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.prepare_trim_by_velocity" class="md-nav__link">
    prepare_trim_by_velocity()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.preprocess" class="md-nav__link">
    preprocess()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.resample" class="md-nav__link">
    resample()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.rotate" class="md-nav__link">
    rotate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.save_to_buffer_raw" class="md-nav__link">
    save_to_buffer_raw()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.save_to_file" class="md-nav__link">
    save_to_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.translate" class="md-nav__link">
    translate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalLeap.trim" class="md-nav__link">
    trim()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate" class="md-nav__link">
    FMSignalTemplate
  </a>
  
    <nav class="md-nav" aria-label="FMSignalTemplate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate.all_close_to" class="md-nav__link">
    all_close_to()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate.construct_from_file" class="md-nav__link">
    construct_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate.construct_from_signals" class="md-nav__link">
    construct_from_signals()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate.load_from_file" class="md-nav__link">
    load_from_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate.save_to_file" class="md-nav__link">
    save_to_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmsignal.FMSignalTemplate.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.dtw" class="md-nav__link">
    dtw()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.dtw_c" class="md-nav__link">
    dtw_c()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.normalize_warping_path_a2to1" class="md-nav__link">
    normalize_warping_path_a2to1()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmsignal.warping_path_to_xy_sequences" class="md-nav__link">
    warping_path_to_xy_sequences()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="fmsignal-module">fmsignal module</h1>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" id="fmsignal" style="visibility: hidden; position: absolute;">
        </h2>
<div class="doc doc-contents first">
<p>This module is the core of the fmkit framework, which is designed to facilitate
researches on in-air-handwriting related research.</p>
<p>Author: Duo Lu &lt;<a href="mailto:duolu.cs@gmail.com">duolu.cs@gmail.com</a>&gt;</p>
<p>Version: 0.1
License: MIT</p>
<p>Updated on Feb. 7, 2020, version 0.1</p>
<p>Created on Aug 14, 2017, draft</p>
<p>The MIT License</p>
<p>Copyright 2017-2021 Duo Lu &lt;<a href="mailto:duolu.cs@gmail.com">duolu.cs@gmail.com</a>&gt;</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of 
this software and associated documentation files (the "Software"), to deal in 
the Software without restriction, including without limitation the rights to 
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies 
of the Software, and to permit persons to whom the Software is furnished to do 
so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all 
copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, 
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE 
SOFTWARE.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="fmsignal.FMSignal">

        <code>FMSignal</code>



      </h2>
<div class="doc doc-contents ">
<p>3D finger motion signal (after preprocessing, device agnostic).</p>
<p>This is the data structure for a finger motion signal. The signal is a time
series containing samples of physical states of one point on a hand, 
captured by a 3D camera device or a wearable data glove device. This is the 
class the abstracts the signal data structure after preprocessing, and it is
device agnostic.</p>
<p><strong>Attributes:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>length</code></td>
<td><code>int</code></td>
<td>
<p>length of the time series (i.e., number of samples).</p>
</td>
</tr>
<tr>
<td><code>dim</code></td>
<td><code>int</code></td>
<td>
<p>dimension of each sample (i.e., number of sensor axes).</p>
</td>
</tr>
<tr>
<td><code>ts</code></td>
<td><code>ndarray</code></td>
<td>
<p>timestamps of each sample, in a len dimensional vector.</p>
</td>
</tr>
<tr>
<td><code>data</code></td>
<td><code>ndarray</code></td>
<td>
<p>the actual time series data, in a len * dim matrix.</p>
</td>
</tr>
<tr>
<td><code>user</code></td>
<td><code>str</code></td>
<td>
<p>the user who creates this signal.</p>
</td>
</tr>
<tr>
<td><code>cid</code></td>
<td><code>str</code></td>
<td>
<p>the unique id indicating the content of the signal.</p>
</td>
</tr>
<tr>
<td><code>seq</code></td>
<td><code>int</code></td>
<td>
<p>the sequence id in a set when loaded from a dataset.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>NOTE</strong>: There are several ways to create an FMSignal object.</p>
<div class="highlight">
<pre><span></span><code>(1) Preprocess a raw signal, i.e., "raw_signal.preprocess()".
(2) Load data from a file with the class method "construct_from_file()".
(3) Deep copy from an existing FMSignal object, i.e., "signal.copy()".
(4) Align to a template or another signal to generate an aligned signal,
    i.e., "signal.align_to(another_signal)"
(5) Modify an existing FMSignal object to generate a new signal, which
    is basically only used for data agumentation.
</code></pre>
</div>
<p>It is not recommended to directly construct an FMSignal object using its
constructor since the attributes may be inconsistent. Instead, please only
use those previously mentioned methods to create an FMSignal object.</p>
<p><strong>NOTE</strong>: Timestamp is always in ms and frequency is always in Hz.</p>
<p><strong>NOTE</strong>: "ts" and "data" both have "dtype == np.float32".</p>
<p>Currently, a signal has the following 18 sensor axes, i.e., "dim" is 18,
and the "data" field has the shape of (len, 18).</p>
<table>
<thead>
<tr>
<th>axes</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0-2</td>
<td>position in x-y-z</td>
</tr>
<tr>
<td>3-5</td>
<td>speed in x-y-z, currently just the derivative of the position</td>
</tr>
<tr>
<td>6-8</td>
<td>acceleration in x-y-z, currently just the derivative of speed</td>
</tr>
<tr>
<td>9-11</td>
<td>orientation, i.e., the x, y, z components of the  quaternion</td>
</tr>
<tr>
<td>12-14</td>
<td>angular speed, currently just the derivative of the orientation</td>
</tr>
<tr>
<td>15-17</td>
<td>angular acceleration, just the derivative of the angular speed</td>
</tr>
</tbody>
</table>
<p>A signal may also have the following optional attributes.</p>
<table>
<thead>
<tr>
<th>attributes</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>len_origin</td>
<td>The length before alignment (only for aligned signals).</td>
</tr>
<tr>
<td>dist</td>
<td>DTW alignment distant (only for aligned signals).</td>
</tr>
<tr>
<td>a2to1_start</td>
<td>Alignment index start array (only for aligned signals).</td>
</tr>
<tr>
<td>a2to1_end</td>
<td>Alignment index end array (only for aligned signals).</td>
</tr>
</tbody>
</table>
<p><strong>NOTE</strong>: "user", "cid", and "seq" are only needed to print information
for debugging. Use the class "FMSignalDesc" to obtain the meta data of the
signal for more details. Typically, the signal file is named as
"user_cid_seq.txt" (or ".csv", or ".npy").</p>
<p>For example, given a file "duolu_duolu_01.txt", the "user" label is "duolu",
the "cid" label is also "duolu", indicating the content is about writing
the string "duolu", and the "seq" is 1, indicating the repetition #1.</p>
<p>Usually, for privacy issues, "user" label and "cid" label are anonymous
strings since they only need to be distinctive instead of meaningful.
For example, "user00_id00_01.txt" means the "user" label is "user00",
the "id" label is "id00", and the seq is 1.</p>
<p><strong>NOTE</strong>: The raw signal file may have two different formats, i.e., either
in Comma Separated Value (".csv") or in NumPy binary format (".npy").
However, the content structure is the same, which is essentially a matrix,
where the rows are the samples at a certain time and the columns are the
data from a specific sensor axis. See the "Data Format Details" document for
more information.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.__init__">

<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

      </h3>
<div class="doc doc-contents ">
<p>Constructor.</p>
<p>See the class attributes for the meaning of the arguments.</p>
<p><strong>NOTE</strong>: This is only for internal usage. If an FMSignal object is
needed, use the class method "construct_from_file()" to load data from
a file, or use the "copy()" method to duplicate a signal, or use the
"align_to()" method to obtain an aligned signal.</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
             <span class="n">user</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Constructor.</span>

<span class="sd">    See the class attributes for the meaning of the arguments.</span>

<span class="sd">    **NOTE**: This is only for internal usage. If an FMSignal object is</span>
<span class="sd">    needed, use the class method "construct_from_file()" to load data from</span>
<span class="sd">    a file, or use the "copy()" method to duplicate a signal, or use the</span>
<span class="sd">    "align_to()" method to obtain an aligned signal.</span>

<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="n">cid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">seq</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.__str__">

<code class="highlight language-python"><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

      </h3>
<div class="doc doc-contents ">
<p>Convert the meta info of the signal to a human readable string.</p>
<p>Currently, the string is "user_cid_seq".</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td><code>None</code></td>
<td>
<p>No arguments.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Convert the meta info of the signal to a human readable string.</span>

<span class="sd">    Currently, the string is "user_cid_seq".</span>

<span class="sd">    Args:</span>

<span class="sd">        None (None): No arguments.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="k">return</span> <span class="s2">"</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%d</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.align_to">

<code class="highlight language-python"><span class="n">align_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">'c'</span><span class="p">,</span> <span class="n">keep_dist_matrix</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Get another signal by aligning the signal to a template signal.</p>
<p><strong>NOTE</strong>: The alignment is done using Dynamic Time Warping (DTW).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>template</code></td>
<td><code>FMSignal</code></td>
<td>
<p>The template signal.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>window</code></td>
<td><code>int</code></td>
<td>
<p>The DTW alignment window.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>penalty</code></td>
<td><code>int</code></td>
<td>
<p>The DTW element-wise missalign penalty.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>method</code></td>
<td><code>string</code></td>
<td>
<p>Implementation method, either "c" or "python".</p>
</td>
<td><code>'c'</code></td>
</tr>
<tr>
<td><code>keep_dist_matrix</code></td>
<td><code>bool</code></td>
<td>
<p>Indicating whether to keep the DTW result,
                     i.e., the "dist_matrix".</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FMSignal</code></td>
<td>
<p>The constructed signal object.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">align_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">DTW_METHOD</span><span class="p">,</span>
    <span class="n">keep_dist_matrix</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Get another signal by aligning the signal to a template signal.</span>

<span class="sd">    **NOTE**: The alignment is done using Dynamic Time Warping (DTW).</span>

<span class="sd">    Args:</span>

<span class="sd">        template (FMSignal): The template signal.</span>
<span class="sd">        window (int): The DTW alignment window.</span>
<span class="sd">        penalty (int): The DTW element-wise missalign penalty.</span>
<span class="sd">        method (string): Implementation method, either "c" or "python".</span>
<span class="sd">        keep_dist_matrix (bool): Indicating whether to keep the DTW result,</span>
<span class="sd">                                 i.e., the "dist_matrix".</span>

<span class="sd">    Returns:</span>

<span class="sd">        FMSignal: The constructed signal object.</span>

<span class="sd">    """</span>

    <span class="n">length_new</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">length</span>
    <span class="n">ts_new</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1">#print(template.data.shape)</span>
    <span class="c1">#print(self.data.shape)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">"python"</span><span class="p">:</span>

        <span class="n">tup</span> <span class="o">=</span> <span class="n">dtw</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">penalty</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">"c"</span><span class="p">:</span>

        <span class="n">tup</span> <span class="o">=</span> <span class="n">dtw_c</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">penalty</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unkown DTW implementation method (</span><span class="si">%s</span><span class="s2">)!"</span> <span class="o">%</span> <span class="n">method</span><span class="p">)</span>


    <span class="p">(</span><span class="n">_dist</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">_d</span><span class="p">,</span> <span class="n">a2to1_start</span><span class="p">,</span> <span class="n">a2to1_end</span><span class="p">,</span> <span class="n">_s</span><span class="p">,</span> <span class="n">_e</span><span class="p">,</span> <span class="n">data_new</span><span class="p">)</span> <span class="o">=</span> <span class="n">tup</span>

    <span class="n">signal</span> <span class="o">=</span> <span class="n">FMSignal</span><span class="p">(</span><span class="n">length_new</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="n">ts_new</span><span class="p">,</span> <span class="n">data_new</span><span class="p">,</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>

    <span class="n">signal</span><span class="o">.</span><span class="n">len_origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>  <br />
<span class="n">signal</span><span class="o">.</span><span class="n">a2to1_start</span> <span class="o">=</span> <span class="n">a2to1_start</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">a2to1_end</span> <span class="o">=</span> <span class="n">a2to1_end</span>

    <span class="k">if</span> <span class="n">keep_dist_matrix</span><span class="p">:</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">dist_matrix</span> <span class="o">=</span> <span class="n">matrix</span>

    <span class="k">return</span> <span class="n">signal</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.all_close_to">

<code class="highlight language-python"><span class="n">all_close_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Check whether this signal is almost identical to another signal.</p>
<p><strong>NOTE</strong>: The criteria of "identical" is defined by "np.allclose()".
The two signals must have the same type and length.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>signal</code></td>
<td><code>FMSignal</code></td>
<td>
<p>The other signal to compare.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>
<p>True if they are almost identical; False otherwise.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">all_close_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">):</span>
    <span class="sd">"""Check whether this signal is almost identical to another signal.</span>

<span class="sd">    **NOTE**: The criteria of "identical" is defined by "np.allclose()".</span>
<span class="sd">    The two signals must have the same type and length.</span>

<span class="sd">    Args:</span>

<span class="sd">        signal (FMSignal): The other signal to compare.</span>

<span class="sd">    Returns:</span>

<span class="sd">        bool: True if they are almost identical; False otherwise.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">FMSignal</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="n">signal</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># NOTE: The CSV format only stores six digits after the decimal point.</span>
    <span class="c1"># Hence, "atol" can not be smaller than 1e-6.</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">r1</span> <span class="ow">and</span> <span class="n">r2</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.amplitude_normalize">

<code class="highlight language-python"><span class="n">amplitude_normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Normalize the amplitude of each sensor axes.</p>
<p><strong>NOTE</strong>: The ratios of x-y-z axes of one type, e.g., position, acc, etc.,
are not perserved.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td><code>None</code></td>
<td>
<p>No argument.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">amplitude_normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Normalize the amplitude of each sensor axes.</span>

<span class="sd">    **NOTE**: The ratios of x-y-z axes of one type, e.g., position, acc, etc.,</span>
<span class="sd">    are not perserved.</span>

<span class="sd">    Args:</span>

<span class="sd">        None (None): No argument.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">):</span>
        <span class="n">data</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">mean</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">std</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.construct_from_file">

<code class="highlight language-python"><span class="n">construct_from_file</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

      </h3>
<div class="doc doc-contents ">
<p>Construct a signal by loading data from a file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fn</code></td>
<td><code>string</code></td>
<td>
<p>The file name (without extension).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>string</code></td>
<td>
<p>The file format (currently either "csv" or "npy").</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>user</code></td>
<td><code>string</code></td>
<td>
<p>The user who creates this signal.</p>
</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>cid</code></td>
<td><code>string</code></td>
<td>
<p>The unique id indicating the content of the signal.</p>
</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>seq</code></td>
<td><code>int</code></td>
<td>
<p>The sequence id in a set when loaded from a dataset.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FMSignal</code></td>
<td>
<p>The constructed signal object.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the "mode" is unknown.</p>
</td>
</tr>
<tr>
<td><code>FileNotFoundError</code></td>
<td>
<p>If the file does not exist.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">construct_from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Construct a signal by loading data from a file.</span>

<span class="sd">    Args:</span>

<span class="sd">        fn (string): The file name (without extension).</span>
<span class="sd">        mode (string): The file format (currently either "csv" or "npy").</span>
<span class="sd">        user (string): The user who creates this signal.</span>
<span class="sd">        cid (string): The unique id indicating the content of the signal.</span>
<span class="sd">        seq (int): The sequence id in a set when loaded from a dataset.</span>

<span class="sd">    Returns:</span>

<span class="sd">        FMSignal: The constructed signal object.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the "mode" is unknown.</span>
<span class="sd">        FileNotFoundError: If the file does not exist.</span>

<span class="sd">    """</span>
    <span class="n">signal</span> <span class="o">=</span> <span class="n">FMSignal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

    <span class="n">signal</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="n">cid</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">seq</span>

    <span class="k">return</span> <span class="n">signal</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.copy">

<code class="highlight language-python"><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Deep copy of the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td><code>None</code></td>
<td>
<p>No arguments.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Deep copy of the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        None (None): No arguments.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">signal</span> <span class="o">=</span> <span class="n">FMSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">signal</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.distance_to">

<code class="highlight language-python"><span class="n">distance_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Calculate the element-wise absolute distance of two signals.</p>
<p><strong>NOTE</strong>: The other signal must be already aligned to this signal, or
their lengths must be the same.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code>FMSignal</code></td>
<td>
<p>The other signal.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ndarray</code></td>
<td>
<p>An array of the absolute difference of the two signals.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If their lengths are different.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">distance_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">"""Calculate the element-wise absolute distance of two signals.</span>

<span class="sd">    **NOTE**: The other signal must be already aligned to this signal, or</span>
<span class="sd">    their lengths must be the same.</span>

<span class="sd">    Args:</span>

<span class="sd">        other (FMSignal): The other signal.</span>

<span class="sd">    Returns:</span>

<span class="sd">        ndarray: An array of the absolute difference of the two signals.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If their lengths are different.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Incompatible signal lengths </span><span class="si">%d</span><span class="s2"> and </span><span class="si">%d</span><span class="s2">."</span> 
                         <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">length</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.filter">

<code class="highlight language-python"><span class="nb">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_freq</span><span class="p">,</span> <span class="n">cut_freq</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Low-pass filtering on the signal (in place).</p>
<p><strong>NOTE</strong>: It is assumed that a hand can not move in very high frequency,
so the high frequency components of the signal is filtered.</p>
<p><strong>NOTE</strong>: This method use NumPy FFT and IFFT. It modifies the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sample_freq</code></td>
<td><code>float</code></td>
<td>
<p>sample frequency of this signal.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>cut_freq</code></td>
<td><code>float</code></td>
<td>
<p>low pass filtering cutoff frequency.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_freq</span><span class="p">,</span> <span class="n">cut_freq</span><span class="p">):</span>
    <span class="sd">"""Low-pass filtering on the signal (in place).</span>

<span class="sd">    **NOTE**: It is assumed that a hand can not move in very high frequency,</span>
<span class="sd">    so the high frequency components of the signal is filtered.</span>

<span class="sd">    **NOTE**: This method use NumPy FFT and IFFT. It modifies the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        sample_freq (float): sample frequency of this signal.</span>
<span class="sd">        cut_freq (float): low pass filtering cutoff frequency.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="n">cut_l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cut_freq</span> <span class="o">*</span> <span class="n">l</span> <span class="o">/</span> <span class="n">sample_freq</span><span class="p">)</span>

    <span class="n">dft_co</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cut_l</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="n">cut_l</span><span class="p">):</span>

        <span class="n">dft_co</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span>

    <span class="n">ifft_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">dft_co</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ifft</span> <span class="o">=</span> <span class="n">ifft_c</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifft</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.get_orientation">

<code class="highlight language-python"><span class="n">get_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Obtain orientation as a series of rotation matrices and quaternions.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td><code>None</code></td>
<td>
<p>No argument.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tuple</code></td>
<td>
<p>A tuple of the following representing the orientation.</p>
<div class="highlight">
<pre><span></span><code>ndarray: The rotation matrices (l-by-3-by-3).
list: The unit quaternions.
</code></pre>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Obtain orientation as a series of rotation matrices and quaternions.</span>

<span class="sd">    Args:</span>

<span class="sd">        None (None): No argument.</span>

<span class="sd">    Returns:</span>

<span class="sd">        tuple: A tuple of the following representing the orientation.</span>

<span class="sd">            ndarray: The rotation matrices (l-by-3-by-3).</span>
<span class="sd">            list: The unit quaternions.</span>
<span class="sd">    """</span>

    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="n">rotms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">qs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">l</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>

        <span class="n">qx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
        <span class="n">qy</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
        <span class="n">qz</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
        <span class="n">qw</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">qx</span> <span class="o">*</span> <span class="n">qx</span> <span class="o">-</span> <span class="n">qy</span> <span class="o">*</span> <span class="n">qy</span> <span class="o">-</span> <span class="n">qz</span> <span class="o">*</span> <span class="n">qz</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">qw</span><span class="p">,</span> <span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">qz</span><span class="p">)</span>
        <span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>
        <span class="n">rotms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">to_rotation_matrix</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">rotms</span><span class="p">,</span> <span class="n">qs</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.load_alignment_index">

<code class="highlight language-python"><span class="n">load_alignment_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Load the alignment indicies from a NumPy binary file (.npy).</p>
<p><strong>NOTE</strong>: The alignment indicies are the "a2to1_start" and "a2to1_end" 
attributes.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fn</code></td>
<td><code>string</code></td>
<td>
<p>The file name (without the ".csv" or ".npy" extension).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>string</code></td>
<td>
<p>The file format (currently either "csv" or "npy").</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>no return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the "mode" is unknown.</p>
</td>
</tr>
<tr>
<td><code>FileNotFoundError</code></td>
<td>
<p>If the file does not exist.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">load_alignment_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">"""Load the alignment indicies from a NumPy binary file (.npy).</span>

<span class="sd">    **NOTE**: The alignment indicies are the "a2to1_start" and "a2to1_end" </span>
<span class="sd">    attributes.</span>

<span class="sd">    Args:</span>

<span class="sd">        fn (string): The file name (without the ".csv" or ".npy" extension).</span>
<span class="sd">        mode (string): The file format (currently either "csv" or "npy").</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: no return value.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the "mode" is unknown.</span>
<span class="sd">        FileNotFoundError: If the file does not exist.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"csv"</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".csv"</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"npy"</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".npy"</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown mode: "</span> <span class="o">+</span> <span class="n">mode</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">a2to1_start</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a2to1_end</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length_origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a2to1_end</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.load_from_file">

<code class="highlight language-python"><span class="n">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Load the signal from a file.</p>
<p><strong>NOTE</strong>: This is only for internal usage. If an FMSignal object is
needed, use the class method "construct_from_file()" instead.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fn</code></td>
<td><code>string</code></td>
<td>
<p>The file name (without the ".csv" or ".npy" extension).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>string</code></td>
<td>
<p>The file format (currently either "csv" or "npy").</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>if the "mode" is unknown.</p>
</td>
</tr>
<tr>
<td><code>FileNotFoundError</code></td>
<td>
<p>if the file does not exist.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">"""Load the signal from a file.</span>

<span class="sd">    **NOTE**: This is only for internal usage. If an FMSignal object is</span>
<span class="sd">    needed, use the class method "construct_from_file()" instead.</span>

<span class="sd">    Args:</span>

<span class="sd">        fn (string): The file name (without the ".csv" or ".npy" extension).</span>
<span class="sd">        mode (string): The file format (currently either "csv" or "npy").</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: if the "mode" is unknown.</span>
<span class="sd">        FileNotFoundError: if the file does not exist.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"csv"</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".csv"</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"npy"</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".npy"</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown mode: "</span> <span class="o">+</span> <span class="n">mode</span><span class="p">)</span>

    <span class="c1"># NOTE: These "copy()" force the "ts" and "data" to have proper C-like</span>
    <span class="c1"># array in memory, which is crucial for "dtw_c()"!!!</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">length</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.pertube_amplitude">

<code class="highlight language-python"><span class="n">pertube_amplitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">s_window</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Pertube the signal at the specified time.</p>
<p><strong>NOTE</strong>: This method is used in data augmentation. It adds a Gaussian
shape pertubation signal segment to the original signal. This method
changes the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>axis</code></td>
<td><code>int</code></td>
<td>
<p>The specified axis to pertube.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>time</code></td>
<td><code>int</code></td>
<td>
<p>The specified time to pertube.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>s_window</code></td>
<td><code>int</code></td>
<td>
<p>The pertubation smooth window size (greater than 0).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>scale</code></td>
<td><code>float</code></td>
<td>
<p>The scale factor of the pertubation (pos or neg).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>sigma</code></td>
<td><code>float</code></td>
<td>
<p>The standard deviation of the Gaussian pertubation. </p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the input arguments are out of range.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">pertube_amplitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">s_window</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">"""Pertube the signal at the specified time.</span>

<span class="sd">    **NOTE**: This method is used in data augmentation. It adds a Gaussian</span>
<span class="sd">    shape pertubation signal segment to the original signal. This method</span>
<span class="sd">    changes the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        axis (int): The specified axis to pertube.</span>
<span class="sd">        time (int): The specified time to pertube.</span>
<span class="sd">        s_window (int): The pertubation smooth window size (greater than 0).</span>
<span class="sd">        scale (float): The scale factor of the pertubation (pos or neg).</span>
<span class="sd">        sigma (float): The standard deviation of the Gaussian pertubation. </span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the input arguments are out of range.</span>


<span class="sd">    """</span>

    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Bad input axis (</span><span class="si">%d</span><span class="s1">)'</span> <span class="o">%</span> <span class="n">axis</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">s_window</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">time</span> <span class="o">&gt;=</span> <span class="n">l</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Bad input time (</span><span class="si">%d</span><span class="s1">)'</span> <span class="o">%</span> <span class="n">time</span><span class="p">)</span>



    <span class="n">pertubation</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">s_window</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span>

    <span class="c1"># Calculate the start indices.</span>
    <span class="n">s_data</span> <span class="o">=</span> <span class="n">time</span> <span class="o">-</span> <span class="n">s_window</span>
    <span class="n">s_pertube</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">s_data</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">s_pertube</span> <span class="o">=</span> <span class="o">-</span><span class="n">s_data</span>
        <span class="n">s_data</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Calculate the end indices.</span>
    <span class="n">e_data</span> <span class="o">=</span> <span class="n">s_data</span> <span class="o">+</span> <span class="n">s_window</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">e_pertube</span> <span class="o">=</span> <span class="n">s_window</span>
    <span class="k">if</span> <span class="n">e_data</span> <span class="o">&gt;</span> <span class="n">l</span><span class="p">:</span>
        <span class="n">e_pertube</span> <span class="o">-=</span> <span class="n">e_data</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">e_data</span> <span class="o">=</span> <span class="n">l</span>


    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_data</span><span class="p">:</span><span class="n">e_data</span><span class="p">,</span> <span class="n">axis</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pertubation</span><span class="p">[</span><span class="n">s_pertube</span><span class="p">:</span><span class="n">e_pertube</span><span class="p">]</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.pertube_amplitude_seg">

<code class="highlight language-python"><span class="n">pertube_amplitude_seg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">s_window</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Pertube the signal at a specified time for a segment.</p>
<p><strong>NOTE</strong>: This method is used in data augmentation. It adds a flat
pertubation signal segment to the original signal with Gaussian smooth
edges on both sides. This method changes the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>axis</code></td>
<td><code>int</code></td>
<td>
<p>The specified axis to pertube.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>time</code></td>
<td><code>int</code></td>
<td>
<p>The specified time to pertube.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>window</code></td>
<td><code>int</code></td>
<td>
<p>The pertubation window size (greater than 0).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>s_window</code></td>
<td><code>int</code></td>
<td>
<p>The pertubation smooth window size (greater than 0).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>scale</code></td>
<td><code>float</code></td>
<td>
<p>The scale factor of the pertubation (pos or neg).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>sigma</code></td>
<td><code>float</code></td>
<td>
<p>The standard deviation of the Gaussian pertubation. </p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the input arguments are out of range.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">pertube_amplitude_seg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">s_window</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">"""Pertube the signal at a specified time for a segment.</span>

<span class="sd">    **NOTE**: This method is used in data augmentation. It adds a flat</span>
<span class="sd">    pertubation signal segment to the original signal with Gaussian smooth</span>
<span class="sd">    edges on both sides. This method changes the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        axis (int): The specified axis to pertube.</span>
<span class="sd">        time (int): The specified time to pertube.</span>
<span class="sd">        window (int): The pertubation window size (greater than 0).</span>
<span class="sd">        s_window (int): The pertubation smooth window size (greater than 0).</span>
<span class="sd">        scale (float): The scale factor of the pertubation (pos or neg).</span>
<span class="sd">        sigma (float): The standard deviation of the Gaussian pertubation. </span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the input arguments are out of range.</span>

<span class="sd">    """</span>

    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Bad input axis: '</span> <span class="o">+</span> <span class="s1">'</span><span class="si">%d</span><span class="s1">'</span> <span class="o">%</span> <span class="n">axis</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">window</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">s_window</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Bad input window (</span><span class="si">%d</span><span class="s1">) or s_window (</span><span class="si">%d</span><span class="s1">)'</span> 
                         <span class="o">%</span> <span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">s_window</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">time</span> <span class="o">+</span> <span class="n">window</span> <span class="o">&gt;=</span> <span class="n">l</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Bad input time (</span><span class="si">%d</span><span class="s1">) or window (</span><span class="si">%d</span><span class="s1">)'</span> 
                         <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">window</span><span class="p">))</span>



    <span class="n">pertube_size</span> <span class="o">=</span> <span class="n">window</span> <span class="o">+</span> <span class="n">s_window</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">pertube_seg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">pertube_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span>

    <span class="c1"># NOTE: The peak of this Gaussian series is 1.</span>
    <span class="n">smooth_edges</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">s_window</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
    <span class="n">se_left</span> <span class="o">=</span> <span class="n">smooth_edges</span><span class="p">[:</span><span class="n">s_window</span><span class="p">]</span>
    <span class="n">se_right</span> <span class="o">=</span> <span class="n">smooth_edges</span><span class="p">[</span><span class="n">s_window</span><span class="p">:]</span>

    <span class="n">pertube_seg</span><span class="p">[:</span><span class="n">s_window</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">pertube_seg</span><span class="p">[:</span><span class="n">s_window</span><span class="p">],</span> <span class="n">se_left</span><span class="p">)</span>
    <span class="n">pertube_seg</span><span class="p">[</span><span class="o">-</span><span class="n">s_window</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">pertube_seg</span><span class="p">[:</span><span class="n">s_window</span><span class="p">],</span> <span class="n">se_right</span><span class="p">)</span>

    <span class="n">s_data</span> <span class="o">=</span> <span class="n">time</span> <span class="o">-</span> <span class="n">s_window</span>
    <span class="n">s_pertube</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">s_data</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">s_pertube</span> <span class="o">=</span> <span class="o">-</span><span class="n">s_data</span>
        <span class="n">s_data</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">e_data</span> <span class="o">=</span> <span class="n">time</span> <span class="o">+</span> <span class="n">window</span> <span class="o">+</span> <span class="n">s_window</span>
    <span class="n">e_pertube</span> <span class="o">=</span> <span class="n">pertube_size</span>
    <span class="k">if</span> <span class="n">e_data</span> <span class="o">&gt;=</span> <span class="n">l</span><span class="p">:</span>
        <span class="n">e_pertube</span> <span class="o">-=</span> <span class="n">e_data</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">e_data</span> <span class="o">=</span> <span class="n">l</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_data</span><span class="p">:</span><span class="n">e_data</span><span class="p">,</span> <span class="n">axis</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pertube_seg</span><span class="p">[</span><span class="n">s_pertube</span><span class="p">:</span><span class="n">e_pertube</span><span class="p">]</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.resize">

<code class="highlight language-python"><span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length_new</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Resize the signal to the specified new length.</p>
<p><strong>NOTE</strong>: This method stretches the signal in time by linear 
interpolation. It is designed for temporal normalization. This method
modifies the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>length_new</code></td>
<td><code>int</code></td>
<td>
<p>The specified new length.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the input arguments are out of range.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length_new</span><span class="p">):</span>
    <span class="sd">"""Resize the signal to the specified new length.</span>

<span class="sd">    **NOTE**: This method stretches the signal in time by linear </span>
<span class="sd">    interpolation. It is designed for temporal normalization. This method</span>
<span class="sd">    modifies the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        length_new (int): The specified new length.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the input arguments are out of range.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">length_new</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Bad new length (</span><span class="si">%d</span><span class="s1">).'</span> <span class="o">%</span> <span class="n">length_new</span><span class="p">)</span>

    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span>

    <span class="n">data_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">length_new</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">ts_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">length_new</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>

    <span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">length_new</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>

        <span class="n">data_new</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>

    <span class="n">ts_new</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length_new</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts_new</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data_new</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.resize_segment">

<code class="highlight language-python"><span class="n">resize_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">seg_length_new</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Resize a segment of the signal and keep other parts untouched.</p>
<p><strong>NOTE</strong>: This method is used in data augmentation. This method changes
the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>start</code></td>
<td><code>int</code></td>
<td>
<p>The start of the segment to stretch.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>window</code></td>
<td><code>int</code></td>
<td>
<p>The stretch window size (greater than 0).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>seg_length_new</code></td>
<td><code>int</code></td>
<td>
<p>The specified new segment length.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the input arguments are out of range.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">resize_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">seg_length_new</span><span class="p">):</span>
    <span class="sd">"""Resize a segment of the signal and keep other parts untouched.</span>

<span class="sd">    **NOTE**: This method is used in data augmentation. This method changes</span>
<span class="sd">    the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        start (int): The start of the segment to stretch.</span>
<span class="sd">        window (int): The stretch window size (greater than 0).</span>
<span class="sd">        seg_length_new (int): The specified new segment length.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the input arguments are out of range.</span>

<span class="sd">    """</span>

    <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">window</span>

    <span class="k">if</span> <span class="n">window</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Bad window size (</span><span class="si">%d</span><span class="s1">).'</span> <span class="o">%</span> <span class="n">window</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">seg_length_new</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Bad new segment length (</span><span class="si">%d</span><span class="s1">).'</span> <span class="o">%</span> <span class="n">seg_length_new</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">end</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Bad input start (</span><span class="si">%d</span><span class="s1">) or window (</span><span class="si">%d</span><span class="s1">).'</span> 
                         <span class="o">%</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">window</span><span class="p">))</span>

    <span class="n">sample_period</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span>
    <span class="n">seg_l</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
    <span class="n">l_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="n">seg_l</span> <span class="o">+</span> <span class="n">seg_length_new</span>
    <span class="n">delta_new</span> <span class="o">=</span> <span class="n">seg_l</span> <span class="o">/</span> <span class="n">seg_length_new</span>

    <span class="n">seg_start_new</span> <span class="o">=</span> <span class="n">start</span>
    <span class="n">seg_end_new</span> <span class="o">=</span> <span class="n">seg_start_new</span> <span class="o">+</span> <span class="n">seg_length_new</span>

    <span class="n">data_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">l_new</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">ts_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">l_new</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="c1"># TODO: rewrite this with array splice and linear interpolation</span>

    <span class="n">data_new</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">start</span><span class="p">]</span>
    <span class="n">data_new</span><span class="p">[</span><span class="n">seg_end_new</span><span class="p">:</span><span class="n">l_new</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">end</span><span class="p">:</span><span class="n">l</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">seg_length_new</span><span class="p">):</span>

        <span class="n">it</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">delta_new</span>
        <span class="n">ii_old</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
        <span class="n">ii_new</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">i</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">it</span> <span class="o">-</span> <span class="n">ii_old</span>

        <span class="c1"># print(i, delta_new, it, ii)</span>

        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">data</span><span class="p">[</span><span class="n">ii_old</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">ii_old</span><span class="p">][</span><span class="n">v</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">ii_old</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">l</span>
                <span class="k">else</span> <span class="n">data</span><span class="p">[</span><span class="n">ii_old</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">ii_old</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">v</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">data_new</span><span class="p">[</span><span class="n">ii_new</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ii_old</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">+</span> <span class="n">rate</span> <span class="o">*</span> <span class="n">dt</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l_new</span><span class="p">):</span>

        <span class="n">ts_new</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_period</span> <span class="o">*</span> <span class="n">i</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">l_new</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">d</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts_new</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data_new</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.save_alignment_index">

<code class="highlight language-python"><span class="n">save_alignment_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Save the alignment indicies to a NumPy binary file (.npy).</p>
<p><strong>NOTE</strong>: The alignment indicies are the "a2to1_start" and "a2to1_end" 
attributes.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fn</code></td>
<td><code>string</code></td>
<td>
<p>file name (without the ".csv" or ".npy" extension).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>string</code></td>
<td>
<p>The file format (currently either "csv" or "npy").</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">save_alignment_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">"""Save the alignment indicies to a NumPy binary file (.npy).</span>

<span class="sd">    **NOTE**: The alignment indicies are the "a2to1_start" and "a2to1_end" </span>
<span class="sd">    attributes.</span>

<span class="sd">    Args:</span>

<span class="sd">        fn (string): file name (without the ".csv" or ".npy" extension).</span>
<span class="sd">        mode (string): The file format (currently either "csv" or "npy").</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="n">column_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a2to1_start</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">column_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a2to1_end</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">column_1</span><span class="p">,</span> <span class="n">column_2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"csv"</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".csv"</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">"</span><span class="si">%d</span><span class="s2">"</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">", "</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"npy"</span><span class="p">:</span>

        <span class="c1"># NOTE: NumPy library add the ".npy" file extension for us!</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown mode: "</span> <span class="o">+</span> <span class="n">mode</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.save_to_file">

<code class="highlight language-python"><span class="n">save_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Save the signal to a file.</p>
<p><strong>NOTE</strong>: Only six digits after the decimal point are kept when floating
point numbers are converted to CSV strings.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fn</code></td>
<td><code>string</code></td>
<td>
<p>file name (without the ".csv" or ".npy" extension).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>string</code></td>
<td>
<p>The file format (currently either "csv" or "npy").</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">save_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">"""Save the signal to a file.</span>

<span class="sd">    **NOTE**: Only six digits after the decimal point are kept when floating</span>
<span class="sd">    point numbers are converted to CSV strings.</span>

<span class="sd">    Args:</span>

<span class="sd">        fn (string): file name (without the ".csv" or ".npy" extension).</span>
<span class="sd">        mode (string): The file format (currently either "csv" or "npy").</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"csv"</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".csv"</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">"</span><span class="si">%.6f</span><span class="s2">"</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">", "</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"npy"</span><span class="p">:</span>

        <span class="k">assert</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
        <span class="c1"># NOTE: NumPy library add the ".npy" file extension for us!</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown mode: "</span> <span class="o">+</span> <span class="n">mode</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.shift_temporally">

<code class="highlight language-python"><span class="n">shift_temporally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shift</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Shift the signal in time.</p>
<p><strong>NOTE</strong>: This method is used in data augmentation. This method modifies
the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>shift</code></td>
<td><code>int</code></td>
<td>
<p>The specified shift in time.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">shift_temporally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shift</span><span class="p">):</span>
    <span class="sd">"""Shift the signal in time.</span>

<span class="sd">    **NOTE**: This method is used in data augmentation. This method modifies</span>
<span class="sd">    the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        shift (int): The specified shift in time.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span>

    <span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">xp</span> <span class="o">+</span> <span class="n">shift</span>

    <span class="n">data_shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># TODO: Rewrite this using array splice.</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>

        <span class="n">data_shift</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data_shift</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.stretch_axis">

<code class="highlight language-python"><span class="n">stretch_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Stretch along a certain sensor axis.</p>
<p><strong>NOTE</strong>: This method is used in data augmentation. This method modifies
the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>axis</code></td>
<td><code>int</code></td>
<td>
<p>The specified sensor axis to stretch.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>scale</code></td>
<td><code>float</code></td>
<td>
<p>The intensity of the stretching.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the input arguments are out of range.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">stretch_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
    <span class="sd">"""Stretch along a certain sensor axis.</span>

<span class="sd">    **NOTE**: This method is used in data augmentation. This method modifies</span>
<span class="sd">    the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        axis (int): The specified sensor axis to stretch.</span>
<span class="sd">        scale (float): The intensity of the stretching.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the input arguments are out of range.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Bad axis (</span><span class="si">%d</span><span class="s1">).'</span> <span class="o">%</span> <span class="n">axis</span><span class="p">)</span>

    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="n">offset_v</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">l</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">axis</span><span class="p">]</span> <span class="o">+=</span> <span class="n">offset_v</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignal.swap_segment">

<code class="highlight language-python"><span class="n">swap_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">s_window</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Swap a segment of this signal with another signal.</p>
<p><strong>NOTE</strong>: This method is used in data augmentation. It generates two
new signals, which are the signals after swapping. It is done on all
axes. This method does not modify this signal or the other signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other</code></td>
<td><code>FMSignal</code></td>
<td>
<p>The other signal.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>start</code></td>
<td><code>int</code></td>
<td>
<p>The start of the segment to swap.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>window</code></td>
<td><code>int</code></td>
<td>
<p>The pertubation window size (greater than 0).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>s_window</code></td>
<td><code>int</code></td>
<td>
<p>The pertubation smooth window size (greater than 0).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tuple</code></td>
<td>
<p>A tuple containing the following.</p>
<div class="highlight">
<pre><span></span><code>FMSignal: This signal after swapping.
FMSignal: The other signal after swapping.
</code></pre>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the input arguments are out of range.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">swap_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">s_window</span><span class="p">):</span>
    <span class="sd">"""Swap a segment of this signal with another signal.</span>

<span class="sd">    **NOTE**: This method is used in data augmentation. It generates two</span>
<span class="sd">    new signals, which are the signals after swapping. It is done on all</span>
<span class="sd">    axes. This method does not modify this signal or the other signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        other (FMSignal): The other signal.</span>
<span class="sd">        start (int): The start of the segment to swap.</span>
<span class="sd">        window (int): The pertubation window size (greater than 0).</span>
<span class="sd">        s_window (int): The pertubation smooth window size (greater than 0).</span>

<span class="sd">    Returns:</span>

<span class="sd">        tuple: A tuple containing the following.</span>

<span class="sd">            FMSignal: This signal after swapping.</span>
<span class="sd">            FMSignal: The other signal after swapping.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the input arguments are out of range.</span>

<span class="sd">    """</span>

    <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">window</span>
    <span class="n">l_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">window</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">s_window</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Bad input window (</span><span class="si">%d</span><span class="s1">) or s_window (</span><span class="si">%d</span><span class="s1">)'</span> 
                         <span class="o">%</span> <span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">s_window</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">end</span> <span class="o">&gt;=</span> <span class="n">l_min</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Bad input start (</span><span class="si">%d</span><span class="s1">) or window (</span><span class="si">%d</span><span class="s1">)'</span> 
                         <span class="o">%</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">window</span><span class="p">))</span>


    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">data_a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">data</span>
    <span class="n">ts_a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">ts</span>
    <span class="n">data_b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">data</span>
    <span class="n">ts_b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">ts</span>

    <span class="n">as1</span> <span class="o">=</span> <span class="n">data_a</span><span class="p">[:</span><span class="n">start</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">as2</span> <span class="o">=</span> <span class="n">data_a</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">as3</span> <span class="o">=</span> <span class="n">data_a</span><span class="p">[</span><span class="n">end</span><span class="p">:,</span> <span class="p">:]</span>

    <span class="n">bs1</span> <span class="o">=</span> <span class="n">data_b</span><span class="p">[:</span><span class="n">start</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">bs2</span> <span class="o">=</span> <span class="n">data_b</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">bs3</span> <span class="o">=</span> <span class="n">data_b</span><span class="p">[</span><span class="n">end</span><span class="p">:,</span> <span class="p">:]</span>

    <span class="n">ats1</span> <span class="o">=</span> <span class="n">ts_a</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span>
    <span class="n">ats2</span> <span class="o">=</span> <span class="n">ts_a</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    <span class="n">ats3</span> <span class="o">=</span> <span class="n">ts_a</span><span class="p">[</span><span class="n">end</span><span class="p">:]</span>

    <span class="n">bts1</span> <span class="o">=</span> <span class="n">ts_b</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span>
    <span class="n">bts2</span> <span class="o">=</span> <span class="n">ts_b</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    <span class="n">bts3</span> <span class="o">=</span> <span class="n">ts_b</span><span class="p">[</span><span class="n">end</span><span class="p">:]</span>

    <span class="n">data_a_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">as1</span><span class="p">,</span> <span class="n">bs2</span><span class="p">,</span> <span class="n">as3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ts_a_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">ats1</span><span class="p">,</span> <span class="n">bts2</span><span class="p">,</span> <span class="n">ats3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">l_a</span> <span class="o">=</span> <span class="n">data_a_new</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">data_b_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">bs1</span><span class="p">,</span> <span class="n">as2</span><span class="p">,</span> <span class="n">bs3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ts_b_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">bts1</span><span class="p">,</span> <span class="n">ats2</span><span class="p">,</span> <span class="n">bts3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">l_b</span> <span class="o">=</span> <span class="n">data_b_new</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Smooth the segment edges with linear interpolation.</span>
    <span class="c1"># TODO: Rewrite this using NumPy vectorized operation.</span>
    <span class="k">if</span> <span class="n">s_window</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

        <span class="c1"># Left margin</span>
        <span class="n">ml_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">start</span> <span class="o">-</span> <span class="n">s_window</span><span class="p">)</span>
        <span class="n">ml_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">s_window</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">l_a</span><span class="p">,</span> <span class="n">l_b</span><span class="p">))</span>
        <span class="n">ml_length</span> <span class="o">=</span> <span class="n">ml_end</span> <span class="o">-</span> <span class="n">ml_start</span>
        <span class="n">ml_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ml_length</span><span class="p">,</span> 
            <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># print(margin1_start, margin1_end)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ml_start</span><span class="p">,</span> <span class="n">ml_end</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">ml_length</span><span class="p">)):</span>

            <span class="n">data_a_new</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ml_factor</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">*</span> <span class="n">data_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
                <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ml_factor</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="o">*</span> <span class="n">data_b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">data_b_new</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ml_factor</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">*</span> <span class="n">data_b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
                <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ml_factor</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="o">*</span> <span class="n">data_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Right margin</span>
        <span class="n">mr_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">s_window</span><span class="p">)</span>
        <span class="n">mr_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="n">s_window</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">l_a</span><span class="p">,</span> <span class="n">l_b</span><span class="p">))</span>
        <span class="n">mr_length</span> <span class="o">=</span> <span class="n">mr_end</span> <span class="o">-</span> <span class="n">mr_start</span>
        <span class="n">mr_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mr_end</span> <span class="o">-</span> <span class="n">mr_start</span><span class="p">,</span> 
            <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># print(margin2_start, margin2_end)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">mr_start</span><span class="p">,</span> <span class="n">mr_end</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">mr_length</span><span class="p">)):</span>

            <span class="n">data_a_new</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mr_factor</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">*</span> <span class="n">data_b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
                <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mr_factor</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="o">*</span> <span class="n">data_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">data_b_new</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mr_factor</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">*</span> <span class="n">data_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
                <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mr_factor</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="o">*</span> <span class="n">data_b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">a</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data_a_new</span>
    <span class="n">a</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts_a_new</span>
    <span class="n">a</span><span class="o">.</span><span class="n">len</span> <span class="o">=</span> <span class="n">l_a</span>
    <span class="n">b</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data_b_new</span>
    <span class="n">b</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts_b_new</span>
    <span class="n">b</span><span class="o">.</span><span class="n">len</span> <span class="o">=</span> <span class="n">l_b</span>

    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
</code></pre>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="fmsignal.FMSignalDesc">

        <code>FMSignalDesc</code>



      </h2>
<div class="doc doc-contents ">
<p>A descriptor of a set of signals of the same writing content.</p>
<p>Typically, these signals are generated by users or imposters writing the 
same content in multiple repetitions. If the contents are different, they
are considered as different set of signals with different descriptors.</p>
<p><strong>NOTE</strong>: One descriptor object corresponds to one line in the meta file.</p>
<p><strong>Attributes:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>uid</code></td>
<td><code>int</code></td>
<td>
<p>A unique ID that orders all descriptors in a collections.
        Usually it is the line number of the descriptor in the meta
        file.</p>
</td>
</tr>
<tr>
<td><code>user</code></td>
<td><code>string</code></td>
<td>
<p>A label indicating which user generates the signals.</p>
</td>
</tr>
<tr>
<td><code>cid</code></td>
<td><code>string</code></td>
<td>
<p>A label indicating the content for classification tasks.
        Note that for spoofing attacks, i.e., different users are
        asked to write the same content, the signals have the same
        id_label. This label is used as the account ID for user
        identification and authentication purpose, and hence it
        gets the name "id_label".</p>
</td>
</tr>
<tr>
<td><code>device</code></td>
<td><code>string</code></td>
<td>
<p>This indicates which type of device is used to obtain
        the signals. Currently it is either "glove" or "leap".</p>
</td>
</tr>
<tr>
<td><code>start</code></td>
<td><code>int</code></td>
<td>
<p>The start repetition sequence number (inclusive).</p>
</td>
</tr>
<tr>
<td><code>end</code></td>
<td><code>int</code></td>
<td>
<p>The end repetition sequence number (exclusive). These
        sequence numbers allow the database to only load a
        specified section of the data, which is very useful when
        spliting the dataset into training and testing set or
        dealing with data augmentation.</p>
</td>
</tr>
<tr>
<td><code>fn_prefix</code></td>
<td><code>string</code></td>
<td>
<p>File name prefix, typically "user_cid". The full
        file name is "fn_prefix" + "_" + "seq" + ".csv" or ".npy",
        where "seq" indicate the specific repetition.</p>
</td>
</tr>
<tr>
<td><code>content</code></td>
<td><code>string</code></td>
<td>
<p>The actual content that is written.</p>
</td>
</tr>
</tbody>
</table>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalDesc.__init__">

<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">fn_prefix</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

      </h3>
<div class="doc doc-contents ">
<p>Constructor.</p>
<p>See the class attributes for the meaning of the arguments.</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> 
    <span class="n">device</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">fn_prefix</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
    <span class="sd">"""Constructor.</span>

<span class="sd">    See the class attributes for the meaning of the arguments.</span>

<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="n">cid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">fn_prefix</span> <span class="o">=</span> <span class="n">fn_prefix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalDesc.__str__">

<code class="highlight language-python"><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

      </h3>
<div class="doc doc-contents ">
<p>Convert a descriptor to a human readable string representation.</p>
<p><strong>NOTE</strong>: Currently it is "uid \t user \t cid \t device".</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Convert a descriptor to a human readable string representation.</span>

<span class="sd">    **NOTE**: Currently it is "uid \\t user \\t cid \\t device".</span>

<span class="sd">    """</span>

    <span class="k">return</span> <span class="s2">"</span><span class="si">%8d</span><span class="se">\t</span><span class="si">%20s</span><span class="se">\t</span><span class="si">%20s</span><span class="se">\t</span><span class="si">%8s</span><span class="se">\t</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalDesc.construct_from_meta_file">

<code class="highlight language-python"><span class="n">construct_from_meta_file</span><span class="p">(</span><span class="n">meta_fn</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

      </h3>
<div class="doc doc-contents ">
<p>Factory method to build list of FMSignalDesc from a metadata file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>meta_fn</code></td>
<td><code>string</code></td>
<td>
<p>The metadata file name.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>list</code></td>
<td>
<p>a list of descriptor objects.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>NOTE</strong>: The meta file contains a table with the following structure,
(columns are seperated by commas):</p>
<table>
<thead>
<tr>
<th>column</th>
<th>type</th>
<th>content</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>int</td>
<td>uid</td>
</tr>
<tr>
<td>1</td>
<td>string</td>
<td>user</td>
</tr>
<tr>
<td>2</td>
<td>string</td>
<td>cid</td>
</tr>
<tr>
<td>3</td>
<td>string</td>
<td>device</td>
</tr>
<tr>
<td>4</td>
<td>int</td>
<td>start repetition sequence number</td>
</tr>
<tr>
<td>5</td>
<td>int</td>
<td>end repetition sequence number</td>
</tr>
<tr>
<td>6</td>
<td>string</td>
<td>file name prefix</td>
</tr>
<tr>
<td>7</td>
<td>string</td>
<td>content</td>
</tr>
</tbody>
</table>
<p>Typically, the file name prefix field is just "user_label_id_label".</p>
<p>See the "data_example" and "meta_example" folders for examples.</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">construct_from_meta_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">meta_fn</span><span class="p">):</span>
    <span class="sd">"""Factory method to build list of FMSignalDesc from a metadata file.</span>

<span class="sd">    Args:</span>

<span class="sd">        meta_fn (string): The metadata file name.</span>

<span class="sd">    Returns:</span>

<span class="sd">        list: a list of descriptor objects.</span>

<span class="sd">    **NOTE**: The meta file contains a table with the following structure,</span>
<span class="sd">    (columns are seperated by commas):</span>

<span class="sd">    column |  type   |  content</span>
<span class="sd">    -------|---------|--------------</span>
<span class="sd">        0  |  int    |  uid</span>
<span class="sd">        1  |  string |  user</span>
<span class="sd">        2  |  string |  cid</span>
<span class="sd">        3  |  string |  device</span>
<span class="sd">        4  |  int    |  start repetition sequence number</span>
<span class="sd">        5  |  int    |  end repetition sequence number</span>
<span class="sd">        6  |  string |  file name prefix</span>
<span class="sd">        7  |  string |  content</span>

<span class="sd">    Typically, the file name prefix field is just "user_label_id_label".</span>

<span class="sd">    See the "data_example" and "meta_example" folders for examples.</span>

<span class="sd">    """</span>

    <span class="n">descs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">meta_fn</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">meta_fd</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">meta_fd</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"#"</span><span class="p">):</span>

                <span class="k">continue</span>

            <span class="n">strs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                <span class="n">strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>

            <span class="n">desc</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">strs</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="n">strs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">strs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">strs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">strs</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">strs</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
                <span class="n">strs</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                <span class="n">strs</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="n">descs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">descs</span>
</code></pre>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="fmsignal.FMSignalGlove">

        <code>FMSignalGlove</code>



      </h2>
<div class="doc doc-contents ">
<p>Raw finger motion signal collected by the data glove.</p>
<p>This class represents the raw signal obtained from the data glove. The glove
uses two BNO055 Inertial Measurement Units (IMU), one on the tip of the
index finger and the other on the tip of the thumb.</p>
<p><strong>Attributes:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>length</code></td>
<td><code>int</code></td>
<td>
<p>The number of samples in this signal.</p>
</td>
</tr>
<tr>
<td><code>ts</code></td>
<td><code>ndarray</code></td>
<td>
<p>Timestamp obtained from the device (1D vector).</p>
</td>
</tr>
<tr>
<td><code>tsc</code></td>
<td><code>ndarray</code></td>
<td>
<p>Timestamp obtained from the client computer (1D vector).</p>
</td>
</tr>
<tr>
<td><code>acc0</code></td>
<td><code>ndarray</code></td>
<td>
<p>The linear acceleration obtained from the first IMU.</p>
</td>
</tr>
<tr>
<td><code>gyro0</code></td>
<td><code>ndarray</code></td>
<td>
<p>The angular speed obtained from the first IMU.</p>
</td>
</tr>
<tr>
<td><code>gravity0</code></td>
<td><code>ndarray</code></td>
<td>
<p>The gravity vector obtained from the first IMU.</p>
</td>
</tr>
<tr>
<td><code>acc1</code></td>
<td><code>ndarray</code></td>
<td>
<p>The linear acceleration obtained from the second IMU.</p>
</td>
</tr>
<tr>
<td><code>gyro1</code></td>
<td><code>ndarray</code></td>
<td>
<p>The angular speed obtained from the second IMU.</p>
</td>
</tr>
<tr>
<td><code>gravity1</code></td>
<td><code>ndarray</code></td>
<td>
<p>The gravity vector obtained from the second IMU.</p>
</td>
</tr>
<tr>
<td><code>data</code></td>
<td><code>ndarray</code></td>
<td>
<p>The data after preprocessing.</p>
</td>
</tr>
<tr>
<td><code>rotms</code></td>
<td><code>ndarray</code></td>
<td>
<p>The orientation of each smple in rotation matrices.</p>
</td>
</tr>
<tr>
<td><code>qs</code></td>
<td><code>list</code></td>
<td>
<p>The orientation of each smple in unit quaternions.</p>
</td>
</tr>
<tr>
<td><code>trajectory</code></td>
<td><code>ndarray</code></td>
<td>
<p>The motion trajectory of the selected IMU.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>NOTE</strong>: The raw sensor data such as "acc0" is a length * 3 matrix.</p>
<p><strong>NOTE</strong>: "data", "rotms", "qs", and "trajectory" are only available after
preprocessing. Since a preprocessed signal (i.e., FMSignal object) contains
the motion of only one point, in the preprocessing procedure, one IMU must
be selected (i.e., by the "point" argument of "preprocess()"). The "rotms"
is a length * 3 * 3 tensor. The "qs" is a list of Quaternion objects from
the "pyrotation" module. The "trajectory" is a length * 3 matrix.</p>
<p><strong>NOTE</strong>: Although the BNO055 IMU can provide absolute orientation fused
by the accelerometer, gyroscope. Additionally, it can provide linear 
acceleration with gravity removed. In our case, The IMU is set to NDOF mode 
(default mode, see BNO055 datasheet section 3.3). We use the linear
acceleration but not the absolute orientation. Instead, we use a simple 
method to derive the orientation by integrating the angular speed. Since 
the signal usually has only a few seconds, this simple method is good
enough. The raw file contains additional columns. See the "Data Format 
Details" document for more information.</p>
<p><strong>NOTE</strong>: The raw signal file may have two different formats, i.e., either
in Comma Separated Value (".csv") or in NumPy binary format (".npy").
However, the content structure is the same, which is essentially a matrix,
where the rows are the samples at a certain time and the columns are the
data from a specific sensor axis. See the "Data Format Details" document for
more information. There is another format called "raw_internal", which is
used to resolve format issues in the data collected at the early stage of
this project. It is now obsolete.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.__init__">

<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

      </h3>
<div class="doc doc-contents ">
<p>Constructor.</p>
<p>See the attributes of FMSignal for the meaning of the arguments.</p>
<p><strong>NOTE</strong>: This is only for internal usage. If an FMSignalGlove object is
needed, use the class method "construct_from_file()" to load data from
a file, or use the "copy()" method to duplicate a signal.</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Constructor.</span>

<span class="sd">    See the attributes of FMSignal for the meaning of the arguments.</span>

<span class="sd">    **NOTE**: This is only for internal usage. If an FMSignalGlove object is</span>
<span class="sd">    needed, use the class method "construct_from_file()" to load data from</span>
<span class="sd">    a file, or use the "copy()" method to duplicate a signal.</span>

<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="n">cid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">seq</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tsc</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">acc0</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gyro0</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gravity0</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">acc1</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gyro1</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gravity1</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rotms</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.all_close_to">

<code class="highlight language-python"><span class="n">all_close_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Check whether this signal is almost identical to the other signal.</p>
<p><strong>NOTE</strong>: The criteria of "identical" is defined by "np.allclose()".
The two signals must have the same type and length.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>signal</code></td>
<td><code>FMSignalGlove</code></td>
<td>
<p>The other signal to compare.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>
<p>True if they are almost identical; False otherwise.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">all_close_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">):</span>
    <span class="sd">"""Check whether this signal is almost identical to the other signal.</span>

<span class="sd">    **NOTE**: The criteria of "identical" is defined by "np.allclose()".</span>
<span class="sd">    The two signals must have the same type and length.</span>

<span class="sd">    Args:</span>

<span class="sd">        signal (FMSignalGlove): The other signal to compare.</span>

<span class="sd">    Returns:</span>

<span class="sd">        bool: True if they are almost identical; False otherwise.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">FMSignalGlove</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="n">signal</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># NOTE: The CSV format only stores six digits after the decimal point.</span>
    <span class="c1"># Hence, "atol" can not be smaller than 1e-6.</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tsc</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">tsc</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acc0</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">acc0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro0</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">gyro0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gravity0</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">gravity0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acc1</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">acc1</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r7</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro1</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">gyro1</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r8</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gravity1</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">gravity1</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">r1</span> <span class="ow">and</span> <span class="n">r2</span> <span class="ow">and</span> <span class="n">r3</span> <span class="ow">and</span> <span class="n">r4</span> <span class="ow">and</span> <span class="n">r5</span> <span class="ow">and</span> <span class="n">r6</span> <span class="ow">and</span> <span class="n">r7</span> <span class="ow">and</span> <span class="n">r8</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.construct_from_file">

<code class="highlight language-python"><span class="n">construct_from_file</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

      </h3>
<div class="doc doc-contents ">
<p>Construct a signal by loading data from a file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fn</code></td>
<td><code>string</code></td>
<td>
<p>The file name (without extension).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>string</code></td>
<td>
<p>The file format, either "raw_csv", or "raw_npy".</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>user</code></td>
<td><code>string</code></td>
<td>
<p>The user who creates this signal.</p>
</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>cid</code></td>
<td><code>string</code></td>
<td>
<p>The unique id indicating the content of the signal.</p>
</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>seq</code></td>
<td><code>int</code></td>
<td>
<p>The sequence id in a set when loaded from a dataset.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FMSignalGlove</code></td>
<td>
<p>The constructed signal object.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the "mode" is wrong.</p>
</td>
</tr>
<tr>
<td><code>FileNotFoundError</code></td>
<td>
<p>If the file does not exist.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">construct_from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Construct a signal by loading data from a file.</span>

<span class="sd">    Args:</span>

<span class="sd">        fn (string): The file name (without extension).</span>
<span class="sd">        mode (string): The file format, either "raw_csv", or "raw_npy".</span>
<span class="sd">        user (string): The user who creates this signal.</span>
<span class="sd">        cid (string): The unique id indicating the content of the signal.</span>
<span class="sd">        seq (int): The sequence id in a set when loaded from a dataset.</span>

<span class="sd">    Returns:</span>

<span class="sd">        FMSignalGlove: The constructed signal object.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the "mode" is wrong.</span>
<span class="sd">        FileNotFoundError: If the file does not exist.</span>

<span class="sd">    """</span>

    <span class="n">signal</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">seq</span><span class="p">)</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">signal</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.convert_axes_to_standard_glove">

<code class="highlight language-python"><span class="n">convert_axes_to_standard_glove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Convert a set of xyz data series to the standard glove axes.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>axes</code></td>
<td><code>ndarray</code></td>
<td>
<p>The original data series.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>NOTE</strong>: This method is designed to handle "raw_internal" signals only.</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">convert_axes_to_standard_glove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>
    <span class="sd">"""Convert a set of xyz data series to the standard glove axes.</span>

<span class="sd">    Args:</span>

<span class="sd">        axes (ndarray): The original data series.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    **NOTE**: This method is designed to handle "raw_internal" signals only.</span>

<span class="sd">    """</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># x &lt;= -y', y &lt;= x'</span>
    <span class="c1"># (x, y) is standard glove. (x', y') is glove2 or glove3.</span>

    <span class="n">temp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">axes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">axes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">axes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.convert_to_standard_glove">

<code class="highlight language-python"><span class="n">convert_to_standard_glove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Convert raw data columns to standard glove reference frame.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>none</code></td>
<td><code>None</code></td>
<td>
<p>No arguments.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>NOTE</strong>: This method is designed to handle "raw_internal" signals only.</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">convert_to_standard_glove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Convert raw data columns to standard glove reference frame.</span>

<span class="sd">    Args:</span>

<span class="sd">        none (None): No arguments.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    **NOTE**: This method is designed to handle "raw_internal" signals only.</span>

<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">convert_axes_to_standard_glove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acc0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">convert_axes_to_standard_glove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">convert_axes_to_standard_glove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gravity0</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">convert_axes_to_standard_glove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acc1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">convert_axes_to_standard_glove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gyro1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">convert_axes_to_standard_glove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gravity1</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.estimate_angular_states">

<code class="highlight language-python"><span class="n">estimate_angular_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Estimate orientation, angular speed, and angular acceleration.</p>
<p><strong>NOTE</strong>: Orientations are represented as the qx, qy, and qz 
components of a unit quaternion. For the data glove device, the angular
speed is directly obtained from the sensor, and the angular po</p>
<p><strong>NOTE</strong>: Currently the beginning of the signal is used as the initial
pose and the integration goes through the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>point</code></td>
<td><code>string</code></td>
<td>
<p>The point on the hand, either "tip" or "center".</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">estimate_angular_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
    <span class="sd">"""Estimate orientation, angular speed, and angular acceleration.</span>

<span class="sd">    **NOTE**: Orientations are represented as the qx, qy, and qz </span>
<span class="sd">    components of a unit quaternion. For the data glove device, the angular</span>
<span class="sd">    speed is directly obtained from the sensor, and the angular po</span>

<span class="sd">    **NOTE**: Currently the beginning of the signal is used as the initial</span>
<span class="sd">    pose and the integration goes through the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        point (string): The point on the hand, either "tip" or "center".</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="k">if</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">"tip"</span><span class="p">:</span>
        <span class="n">gyro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro0</span>
    <span class="k">elif</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">"center"</span><span class="p">:</span>
        <span class="n">gyro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown point type: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="p">))</span>


    <span class="n">q</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="o">.</span><span class="n">identity</span><span class="p">()</span>

    <span class="c1"># rotation matrix of each data sample</span>
    <span class="n">rotms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="c1"># quaternion of each data sample</span>
    <span class="n">qs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">l</span>


    <span class="c1"># Given 50 Hz, one timestep is 20 ms, i.e., 0.02 second</span>
    <span class="n">timestep</span> <span class="o">=</span> <span class="mf">0.02</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>

        <span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>

        <span class="n">rotm</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">to_rotation_matrix</span><span class="p">()</span>

        <span class="n">rotms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotm</span>


        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">x</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">y</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">z</span>

        <span class="c1"># z, y, x = rotation_matrix_to_euler_angles_zyx(rotm)</span>

        <span class="c1"># yaw, pitch, roll, gimbal_lock \</span>
        <span class="c1">#     = rotation_matrix_to_euler_angles_zyx(rotm)</span>

        <span class="c1"># data[i, 9] = roll</span>
        <span class="c1"># data[i, 10] = pitch</span>
        <span class="c1"># data[i, 11] = yaw</span>

        <span class="c1"># assert not gimbal_lock</span>

        <span class="c1"># NOTE: Gyro output is in rad/s</span>
        <span class="n">omega</span> <span class="o">=</span> <span class="n">gyro</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="o">.</span><span class="n">integrate_local</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span>
        <span class="n">q</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>

    <span class="n">data</span><span class="p">[:,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">gyro</span>

    <span class="n">data</span><span class="p">[:,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">12</span><span class="p">])</span>
    <span class="n">data</span><span class="p">[:,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">13</span><span class="p">])</span>
    <span class="n">data</span><span class="p">[:,</span> <span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">14</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rotms</span> <span class="o">=</span> <span class="n">rotms</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.estimate_linear_states">

<code class="highlight language-python"><span class="n">estimate_linear_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">wv</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">wp</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Estimate position, velocity and acceleration.</p>
<p><strong>NOTE</strong>: For the data glove device, the linear acceleration is directly
obtained from the sensor. The position and velocity are derived by
integrating the linear acceleration.</p>
<p><strong>NOTE</strong>: This method depends on the orientation. Hence, it must be
called after "estimate_angular_states()"</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">estimate_linear_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">wv</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">wp</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">"""Estimate position, velocity and acceleration.</span>

<span class="sd">    **NOTE**: For the data glove device, the linear acceleration is directly</span>
<span class="sd">    obtained from the sensor. The position and velocity are derived by</span>
<span class="sd">    integrating the linear acceleration.</span>

<span class="sd">    **NOTE**: This method depends on the orientation. Hence, it must be</span>
<span class="sd">    called after "estimate_angular_states()"</span>

<span class="sd">    """</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="k">if</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">"tip"</span><span class="p">:</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc0</span>
    <span class="k">elif</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">"center"</span><span class="p">:</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown point type: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="p">))</span>

    <span class="n">trajectory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="n">qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qs</span>

    <span class="c1"># given 50 Hz, one timestep is 20 ms, i.e., 0.02 second</span>
    <span class="n">timestep</span> <span class="o">=</span> <span class="mf">0.02</span>

    <span class="c1"># dead reckoning using linear acceleration</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">v_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">a_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="n">pp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>

        <span class="n">acc_local</span> <span class="o">=</span> <span class="n">acc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">a_m</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">rotate_a_point</span><span class="p">(</span><span class="n">acc_local</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>



        <span class="n">pp_i</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">rotate_a_point</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">trajectory</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">pp_i</span>

        <span class="n">v_m</span> <span class="o">=</span> <span class="n">v_m</span> <span class="o">+</span> <span class="n">a_m</span> <span class="o">*</span> <span class="n">timestep</span>


        <span class="c1"># Now we add a correction term</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">v_m</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v_m</span><span class="p">))</span>
        <span class="n">v_m</span> <span class="o">=</span> <span class="n">v_m</span> <span class="o">-</span> <span class="n">wv</span> <span class="o">*</span> <span class="n">u</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">v_m</span> <span class="o">*</span> <span class="n">timestep</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">a_m</span> <span class="o">*</span> <span class="n">timestep</span> <span class="o">*</span> <span class="n">timestep</span>

        <span class="c1">#print(p)</span>

        <span class="c1"># Now we add a similar correction term.</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">wp</span> <span class="o">*</span> <span class="n">w</span>

        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_m</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_m</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># position is in mm</span>


    <span class="n">trajectory</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">200</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.filter">

<code class="highlight language-python"><span class="nb">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_freq</span><span class="p">,</span> <span class="n">cut_freq</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Low-pass filtering on the signal.</p>
<p><strong>NOTE</strong>: It is assumed that a hand can not move in very high frequency,
so the high frequency components of the signal is filtered. This method
uses NumPy FFT and IFFT.</p>
<p><strong>NOTE</strong>: This method is only used in the preprocessing procedure.
This method modifies the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sample_freq</code></td>
<td><code>float</code></td>
<td>
<p>sample frequency of this signal.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>cut_freq</code></td>
<td><code>float</code></td>
<td>
<p>low pass filtering cutoff frequency.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_freq</span><span class="p">,</span> <span class="n">cut_freq</span><span class="p">):</span>
    <span class="sd">"""Low-pass filtering on the signal.</span>

<span class="sd">    **NOTE**: It is assumed that a hand can not move in very high frequency,</span>
<span class="sd">    so the high frequency components of the signal is filtered. This method</span>
<span class="sd">    uses NumPy FFT and IFFT.</span>

<span class="sd">    **NOTE**: This method is only used in the preprocessing procedure.</span>
<span class="sd">    This method modifies the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        sample_freq (float): sample frequency of this signal.</span>
<span class="sd">        cut_freq (float): low pass filtering cutoff frequency.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="n">cut_l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cut_freq</span> <span class="o">*</span> <span class="n">l</span> <span class="o">/</span> <span class="n">sample_freq</span><span class="p">)</span>

    <span class="n">dft_co</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cut_l</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="n">cut_l</span><span class="p">):</span>

        <span class="n">dft_co</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span>

    <span class="n">ifft_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">dft_co</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># NOTE: This must be converted to "np.float32"!</span>
    <span class="n">ifft</span> <span class="o">=</span> <span class="n">ifft_c</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifft</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.load_from_buffer_raw">

<code class="highlight language-python"><span class="n">load_from_buffer_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Load data from a NumPy ndarray.</p>
<p><strong>NOTE</strong>: This is only for internal usage.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>array</code></td>
<td><code>ndarray</code></td>
<td>
<p>The buffer.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">load_from_buffer_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
    <span class="sd">"""Load data from a NumPy ndarray.</span>

<span class="sd">    **NOTE**: This is only for internal usage.</span>

<span class="sd">    Args:</span>

<span class="sd">        array (ndarray): The buffer.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">l</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">"Wrong raw file format: m = </span><span class="si">%d</span><span class="s2">"</span> <span class="o">%</span> <span class="n">m</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">l</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tsc</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">acc0</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gyro0</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gravity0</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">8</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">acc1</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">11</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gyro1</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">14</span><span class="p">:</span><span class="mi">17</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gravity1</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.load_from_buffer_raw_internal">

<code class="highlight language-python"><span class="n">load_from_buffer_raw_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Load from a file directly obtained by the data collection client.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>array</code></td>
<td><code>ndarray</code></td>
<td>
<p>The buffer, which is a numpy ndarrary.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p>CAUTION: Do not use this method directly. Instead, uses the class
method FMSignalGlove.construct_from_file() instead.</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">load_from_buffer_raw_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
    <span class="sd">"""Load from a file directly obtained by the data collection client.</span>

<span class="sd">    Args:</span>

<span class="sd">        array (ndarray): The buffer, which is a numpy ndarrary.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    CAUTION: Do not use this method directly. Instead, uses the class</span>
<span class="sd">    method FMSignalGlove.construct_from_file() instead.</span>

<span class="sd">    """</span>

    <span class="n">l</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">l</span>

    <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">25</span><span class="p">:</span>

        <span class="c1"># NOTE: This is the early format, with only one timestamp.</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">tsc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="n">acc0</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">gyro0</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
        <span class="n">gravity0</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>

        <span class="n">acc1</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">13</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span>
        <span class="n">gyro1</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">16</span><span class="p">:</span><span class="mi">19</span><span class="p">]</span>
        <span class="n">gravity1</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">19</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">34</span><span class="p">:</span>

        <span class="c1"># NOTE: This is the current format, with two timestamps.</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">tsc</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

       <span class="c1"># Use an offset to reduce the size of tsc so that it can fit into</span>
        <span class="c1"># the float32 type.</span>
        <span class="n">tsc</span> <span class="o">-=</span> <span class="mi">1514764800</span>

        <span class="n">acc0</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">gyro0</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">gravity0</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">11</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span>

        <span class="n">acc1</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">18</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span>
        <span class="n">gyro1</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">21</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span>
        <span class="n">gravity1</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">27</span><span class="p">:</span><span class="mi">30</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown format: m = </span><span class="si">%d</span><span class="s2">"</span> <span class="o">%</span> <span class="n">m</span><span class="p">)</span>

    <span class="c1"># Fix any timestamp anormaly</span>
    <span class="c1"># NOTE: The device timestamps in glove data are in millisecond.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">ts</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">ts</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tsc</span> <span class="o">=</span> <span class="n">tsc</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">acc0</span> <span class="o">=</span> <span class="n">acc0</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gyro0</span> <span class="o">=</span> <span class="n">gyro0</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gravity0</span> <span class="o">=</span> <span class="n">gravity0</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">acc1</span> <span class="o">=</span> <span class="n">acc1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gyro1</span> <span class="o">=</span> <span class="n">gyro1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gravity1</span> <span class="o">=</span> <span class="n">gravity1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.load_from_file">

<code class="highlight language-python"><span class="n">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>General interface to load the raw signal from a file.</p>
<p><strong>NOTE</strong>: This is only for internal usage. If an FMSignalLeap object is
needed, use the class method "construct_from_file()" instead.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fn</code></td>
<td><code>string</code></td>
<td>
<p>The file name (without the ".csv" or ".npy" extension).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>string</code></td>
<td>
<p>The file format, either "raw_csv", or "raw_npy".</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>if the "mode" is unknown.</p>
</td>
</tr>
<tr>
<td><code>FileNotFoundError</code></td>
<td>
<p>if the file does not exist.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">"""General interface to load the raw signal from a file.</span>

<span class="sd">    **NOTE**: This is only for internal usage. If an FMSignalLeap object is</span>
<span class="sd">    needed, use the class method "construct_from_file()" instead.</span>

<span class="sd">    Args:</span>

<span class="sd">        fn (string): The file name (without the ".csv" or ".npy" extension).</span>
<span class="sd">        mode (string): The file format, either "raw_csv", or "raw_npy".</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: if the "mode" is unknown.</span>
<span class="sd">        FileNotFoundError: if the file does not exist.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"raw_internal"</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".txt"</span>
        <span class="c1"># NOTE: The "dtype" needs to be np.float64 for the raw timestamps!</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_from_buffer_raw_internal</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"raw_csv"</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".csv"</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_from_buffer_raw</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"raw_npy"</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".npy"</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_from_buffer_raw</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown file mode </span><span class="si">%s</span><span class="s2">!"</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.pose_normalize">

<code class="highlight language-python"><span class="n">pose_normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">p_yaw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_pitch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_roll</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Normalize the position and orientation of the signal.</p>
<p><strong>NOTE</strong>: This method expect a start index and an end index, where the
signal segment between the start and the end is used to calculate the
average pointing direction. Hence, it should be called after
"prepare_trim_by_xxx()".</p>
<p><strong>NOTE</strong>: This normalization step depends on the orientation. Hence,
it must be called after "estimate_angular_states()"</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>start</code></td>
<td><code>int</code></td>
<td>
<p>The start time index of the signal for normalization.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>end</code></td>
<td><code>int</code></td>
<td>
<p>The end time index of the signal for normalization.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>p_yaw</code></td>
<td><code>float</code></td>
<td>
<p>The pertubation yaw angle in radian.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>p_pitch</code></td>
<td><code>float</code></td>
<td>
<p>The pertubation pitch angle in radian.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>p_roll</code></td>
<td><code>float</code></td>
<td>
<p>The pertubation roll angle in radian.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the "point" is wrong or the "start" or "end" is bad.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">pose_normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">p_yaw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_pitch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_roll</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Normalize the position and orientation of the signal.</span>

<span class="sd">    **NOTE**: This method expect a start index and an end index, where the</span>
<span class="sd">    signal segment between the start and the end is used to calculate the</span>
<span class="sd">    average pointing direction. Hence, it should be called after</span>
<span class="sd">    "prepare_trim_by_xxx()".</span>

<span class="sd">    **NOTE**: This normalization step depends on the orientation. Hence,</span>
<span class="sd">    it must be called after "estimate_angular_states()"</span>

<span class="sd">    Args:</span>

<span class="sd">        start (int): The start time index of the signal for normalization.</span>
<span class="sd">        end (int): The end time index of the signal for normalization.</span>
<span class="sd">        p_yaw (float): The pertubation yaw angle in radian.</span>
<span class="sd">        p_pitch (float): The pertubation pitch angle in radian.</span>
<span class="sd">        p_roll (float): The pertubation roll angle in radian.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the "point" is wrong or the "start" or "end" is bad.</span>

<span class="sd">    """</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="n">rotms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotms</span>
    <span class="n">qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qs</span>

    <span class="n">vi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># vj = np.array((0, 1.0, 0), np.float32).reshape((3, 1))</span>
    <span class="n">vk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># find the approximated average pointing direction as vx</span>
    <span class="c1"># find the approximated average downward direction as vz</span>
    <span class="n">vxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">rotms</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">vi</span><span class="p">)</span>
    <span class="n">vzs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">rotms</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">vk</span><span class="p">)</span>

    <span class="n">vx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vxs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vzs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="n">vx</span> <span class="o">=</span> <span class="n">vx</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vx</span><span class="p">)</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="n">vz</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vz</span><span class="p">)</span>

    <span class="n">vy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vz</span><span class="p">,</span> <span class="n">vx</span><span class="p">)</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="n">vy</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vy</span><span class="p">)</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">)</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="n">vz</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vz</span><span class="p">)</span>

    <span class="n">vx</span> <span class="o">=</span> <span class="n">vx</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="n">vy</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="n">vz</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">R_g2l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">normalize_rotation_matrix</span><span class="p">(</span><span class="n">R_g2l</span><span class="p">)</span>

    <span class="n">R_l2g</span> <span class="o">=</span> <span class="n">R_g2l</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="n">R_offset</span> <span class="o">=</span> <span class="n">euler_zyx_to_rotation_matrix</span><span class="p">(</span><span class="n">p_yaw</span><span class="p">,</span> <span class="n">p_pitch</span><span class="p">,</span> <span class="n">p_roll</span><span class="p">)</span>

    <span class="n">R_l2g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R_offset</span><span class="p">,</span> <span class="n">R_l2g</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">):</span>

        <span class="n">rotm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R_l2g</span><span class="p">,</span> <span class="n">rotms</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">rotm</span> <span class="o">=</span> <span class="n">normalize_rotation_matrix</span><span class="p">(</span><span class="n">rotm</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="o">.</span><span class="n">construct_from_rotation_matrix</span><span class="p">(</span><span class="n">rotm</span><span class="p">)</span>

        <span class="n">rotms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotm</span>
        <span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>

        <span class="c1"># Now we derive the three Tait-Bryan angles</span>
        <span class="c1"># CAUTION: yaw first, then pitch, then roll</span>
        <span class="c1"># i.e., z-y-x intrinsic rotation (east, north, sky)</span>

        <span class="c1">#             yaw, pitch, roll, gimbal_lock \</span>
        <span class="c1">#                 = rotation_matrix_to_euler_angles_zyx(rotm)</span>
        <span class="c1">#</span>
        <span class="c1">#             data[i, 9] = roll</span>
        <span class="c1">#             data[i, 10] = pitch</span>
        <span class="c1">#             data[i, 11] = yaw</span>

        <span class="c1"># Tait-Bryan angles have singularity.</span>
        <span class="c1"># Use quaternion components instead.</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">x</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">y</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">z</span>

        <span class="c1"># verify using the gravity vector</span>
        <span class="c1"># self.data[i, 3:6] = np.matmul(rotms[i], gravity0[i].reshape((3, 1))).reshape(3)</span>

    <span class="c1"># apply pose offset on angular speed</span>
    <span class="n">ov</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    <span class="n">ov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R_offset</span><span class="p">,</span> <span class="n">ov</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[:,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">ov</span><span class="o">.</span><span class="n">T</span>

    <span class="n">data</span><span class="p">[:,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">12</span><span class="p">])</span>
    <span class="n">data</span><span class="p">[:,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">13</span><span class="p">])</span>
    <span class="n">data</span><span class="p">[:,</span> <span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">14</span><span class="p">])</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.prepare_trim_by_acc">

<code class="highlight language-python"><span class="n">prepare_trim_by_acc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Determine the indicies for the start and end of the finger motion.</p>
<p><strong>NOTE</strong>: The trimming process is split into two parts to accommodate
other preprocessing steps. This method is the first part, which returns
the start and end indices without actually throwing away the data 
samples when the hand is not moving.</p>
<p><strong>NOTE</strong>: This method is only used in the preprocessing procedure.
This method <strong>DOES NOT</strong> modify the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>point</code></td>
<td><code>string</code></td>
<td>
<p>The point on the hand, either "tip" or "center".</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>threshold</code></td>
<td><code>float</code></td>
<td>
<p>Threshold to detect the hand motion.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>NOTE</strong>: The threshold is relative. Typically some value between 0.2 
to 0.5 would be good enough.</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">prepare_trim_by_acc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
    <span class="sd">"""Determine the indicies for the start and end of the finger motion.</span>

<span class="sd">    **NOTE**: The trimming process is split into two parts to accommodate</span>
<span class="sd">    other preprocessing steps. This method is the first part, which returns</span>
<span class="sd">    the start and end indices without actually throwing away the data </span>
<span class="sd">    samples when the hand is not moving.</span>

<span class="sd">    **NOTE**: This method is only used in the preprocessing procedure.</span>
<span class="sd">    This method **DOES NOT** modify the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        point (string): The point on the hand, either "tip" or "center".</span>
<span class="sd">        threshold (float): Threshold to detect the hand motion.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    **NOTE**: The threshold is relative. Typically some value between 0.2 </span>
<span class="sd">    to 0.5 would be good enough.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">"tip"</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc0</span>
    <span class="k">elif</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">"center"</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown point type: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="p">))</span>

    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="n">acc</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">a_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="c1"># NOTE: We cannot subtract the mean of acceleration here.</span>
    <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_std</span><span class="p">)</span>

    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">5</span>
            <span class="k">break</span>
    <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span>
            <span class="k">break</span>
    <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.preprocess">

<code class="highlight language-python"><span class="n">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">cut_freq</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">p_yaw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_pitch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_roll</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Preprocess the signal.</p>
<p><strong>NOTE</strong>: This method follows all the preprocessing steps. See the
"Data Processing" document for details.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>point</code></td>
<td><code>string</code></td>
<td>
<p>The point on the hand, either "tip" or "center".</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>threshold</code></td>
<td><code>float</code></td>
<td>
<p>Threshold to trim the signal without hand motion.</p>
</td>
<td><code>0.2</code></td>
</tr>
<tr>
<td><code>cut_freq</code></td>
<td><code>float</code></td>
<td>
<p>Low pass filtering cutoff frequency.</p>
</td>
<td><code>10</code></td>
</tr>
<tr>
<td><code>p_yaw</code></td>
<td><code>float</code></td>
<td>
<p>The pertubation yaw angle in radian.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>p_pitch</code></td>
<td><code>float</code></td>
<td>
<p>The pertubation pitch angle in radian.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>p_roll</code></td>
<td><code>float</code></td>
<td>
<p>The pertubation roll angle in radian.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FMSignal</code></td>
<td>
<p>The preprocessed signal.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>NOTE</strong>: The default argument values are typically good enough.</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">cut_freq</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
               <span class="n">p_yaw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_pitch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_roll</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Preprocess the signal.</span>

<span class="sd">    **NOTE**: This method follows all the preprocessing steps. See the</span>
<span class="sd">    "Data Processing" document for details.</span>

<span class="sd">    Args:</span>

<span class="sd">        point (string): The point on the hand, either "tip" or "center".</span>
<span class="sd">        threshold (float): Threshold to trim the signal without hand motion.</span>
<span class="sd">        cut_freq (float): Low pass filtering cutoff frequency.</span>
<span class="sd">        p_yaw (float): The pertubation yaw angle in radian.</span>
<span class="sd">        p_pitch (float): The pertubation pitch angle in radian.</span>
<span class="sd">        p_roll (float): The pertubation roll angle in radian.</span>

<span class="sd">    Returns:</span>

<span class="sd">        FMSignal: The preprocessed signal.</span>

<span class="sd">    **NOTE**: The default argument values are typically good enough.</span>

<span class="sd">    """</span>

    <span class="n">dim</span> <span class="o">=</span> <span class="mi">18</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">dim</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_trim_by_acc</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">estimate_angular_states</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pose_normalize</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">p_yaw</span><span class="p">,</span> <span class="n">p_pitch</span><span class="p">,</span> <span class="n">p_roll</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">estimate_linear_states</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

    <span class="n">sample_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1000.0</span>

    <span class="c1">#self.filter(sample_freq, cut_freq)</span>

    <span class="c1">#self.trim(start, end)</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>

    <span class="n">signal</span> <span class="o">=</span> <span class="n">FMSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">signal</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.save_to_buffer_raw">

<code class="highlight language-python"><span class="n">save_to_buffer_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Save the raw signal to a NumPy ndarray.</p>
<p><strong>NOTE</strong>: This is only for internal usage.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td><code>None</code></td>
<td>
<p>No argument.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ndarray</code></td>
<td>
<p>The buffer.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">save_to_buffer_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Save the raw signal to a NumPy ndarray.</span>

<span class="sd">    **NOTE**: This is only for internal usage.</span>

<span class="sd">    Args:</span>

<span class="sd">        None (None): No argument.</span>

<span class="sd">    Returns:</span>

<span class="sd">        ndarray: The buffer.</span>

<span class="sd">    """</span>

    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsc</span>
    <span class="n">array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>

    <span class="n">array</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc0</span>
    <span class="n">array</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro0</span>
    <span class="n">array</span><span class="p">[:,</span> <span class="mi">8</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gravity0</span>

    <span class="n">array</span><span class="p">[:,</span> <span class="mi">11</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc1</span>
    <span class="n">array</span><span class="p">[:,</span> <span class="mi">14</span><span class="p">:</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gyro1</span>
    <span class="n">array</span><span class="p">[:,</span> <span class="mi">17</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gravity1</span>

    <span class="k">return</span> <span class="n">array</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.save_to_file">

<code class="highlight language-python"><span class="n">save_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>General interface to save the raw signal to a file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fn</code></td>
<td><code>string</code></td>
<td>
<p>The file name (without the ".csv" or ".npy" extension).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>string</code></td>
<td>
<p>The file format, either "raw_csv", or "raw_npy".</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">save_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">"""General interface to save the raw signal to a file.</span>

<span class="sd">    Args:</span>

<span class="sd">        fn (string): The file name (without the ".csv" or ".npy" extension).</span>
<span class="sd">        mode (string): The file format, either "raw_csv", or "raw_npy".</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"raw_csv"</span><span class="p">:</span>

        <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_to_buffer_raw</span><span class="p">()</span>
        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".csv"</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">"</span><span class="si">%.6f</span><span class="s2">"</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">", "</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"raw_npy"</span><span class="p">:</span>

        <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_to_buffer_raw</span><span class="p">()</span>
        <span class="c1"># NOTE: NumPy library add the ".npy" file extension for us!</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown file mode </span><span class="si">%s</span><span class="s2">!"</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalGlove.trim">

<code class="highlight language-python"><span class="n">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Trim the start and end of the signal where the hand does not move.</p>
<p><strong>NOTE</strong>: The trimming process is split into two parts to accommodate
other steps of preprocessing. This method is the second part, which 
throws away the data samples given the start and end indices.</p>
<p><strong>NOTE</strong>: This method is only used in the preprocessing procedure.
This method modifies the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>start</code></td>
<td><code>int</code></td>
<td>
<p>The start index, i.e., data[start:end, :] will be kept.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>end</code></td>
<td><code>int</code></td>
<td>
<p>The end index, i.e., data[start:end, :] will be kept.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="sd">"""Trim the start and end of the signal where the hand does not move.</span>

<span class="sd">    **NOTE**: The trimming process is split into two parts to accommodate</span>
<span class="sd">    other steps of preprocessing. This method is the second part, which </span>
<span class="sd">    throws away the data samples given the start and end indices.</span>

<span class="sd">    **NOTE**: This method is only used in the preprocessing procedure.</span>
<span class="sd">    This method modifies the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        start (int): The start index, i.e., data[start:end, :] will be kept.</span>
<span class="sd">        end (int): The end index, i.e., data[start:end, :] will be kept.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">l_new</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>

    <span class="c1"># NOTE: These "copy()" force the "ts" and "data" to have proper C-like</span>
    <span class="c1"># array in memory, which is crucial for "dtw_c()"!!!</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">ts0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">-=</span> <span class="n">ts0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">l_new</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qs</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotms</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</code></pre>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="fmsignal.FMSignalLeap">

        <code>FMSignalLeap</code>



      </h2>
<div class="doc doc-contents ">
<p>Raw finger motion signal collected by the Leap Motion controller.</p>
<p>This class represents the raw signal obtained from the Leap Motion sensor.
An FMSignal object can be obtained by preprocessing this raw signal, where
the preprocessing is essentially the main purpose of this FMSignalLeap 
class. It has the following additional attributes.</p>
<p><strong>Attributes:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>length</code></td>
<td><code>int</code></td>
<td>
<p>The number of samples in this signal.</p>
</td>
</tr>
<tr>
<td><code>ts</code></td>
<td><code>ndarray</code></td>
<td>
<p>Timestamp obtained from the device (1D vector).</p>
</td>
</tr>
<tr>
<td><code>tsc</code></td>
<td><code>ndarray</code></td>
<td>
<p>Timestamp obtained from the client computer (1D vector).</p>
</td>
</tr>
<tr>
<td><code>tip</code></td>
<td><code>ndarray</code></td>
<td>
<p>Position of the index finger tip (length * 3 matrix).</p>
</td>
</tr>
<tr>
<td><code>center</code></td>
<td><code>ndarray</code></td>
<td>
<p>Position of the palm center (length * 3 matrix).</p>
</td>
</tr>
<tr>
<td><code>joints</code></td>
<td><code>ndarray</code></td>
<td>
<p>Position of each joint (length * 5 * 5 * 3 tensor).</p>
</td>
</tr>
<tr>
<td><code>confs</code></td>
<td><code>ndarray</code></td>
<td>
<p>Confidence value of each sample (1D vector).</p>
</td>
</tr>
<tr>
<td><code>valids</code></td>
<td><code>ndarray</code></td>
<td>
<p>Whether the sample is valid (1D vector).</p>
</td>
</tr>
<tr>
<td><code>data</code></td>
<td><code>ndarray</code></td>
<td>
<p>The data after preprocessing.</p>
</td>
</tr>
<tr>
<td><code>rotms</code></td>
<td><code>ndarray</code></td>
<td>
<p>The orientation of each smple in rotation matrices.</p>
</td>
</tr>
<tr>
<td><code>qs</code></td>
<td><code>list</code></td>
<td>
<p>The orientation of each smple in unit quaternions.</p>
</td>
</tr>
<tr>
<td><code>trajectory</code></td>
<td><code>ndarray</code></td>
<td>
<p>The motion trajectory of the selected point.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>NOTE</strong>: The "joints" is a length * 5 * 5 * 3 tensor, i.e., 5 fingers, 5 
joints on each finger, and 3 coordinates for each joint. The sequence of 
fingers are [thumb, index finger, middle finger, ring finger, little 
finger]. The sequence of joints are from the end of the palm to the tip of
the finger. For example, "joints[:, 1, 0, :]" is the trajectory of the palm
end of the index finger, and "joints[:, 1, 4, :]" is the trajectory of the
tip of the index finger. Note that the thumb has only four joints, i.e.,
"joints[:, 0, 0, :]" and "joints[:, 0, 1, :]" are identical.</p>
<p><strong>NOTE</strong>: The preprocessed signal contains the motion of only one point on
the hand, which can be derived either from the center of the hand or the tip
of the index finger. This is controlled by the "point" argument of the
"preprocess()" method.</p>
<p><strong>NOTE</strong>: The raw signal file may have two different formats, i.e., either
in Comma Separated Value (".csv") or in NumPy binary format (".npy").
However, the content structure is the same, which is essentially a matrix,
where the rows are the samples at a certain time and the columns are the
data from a specific sensor axis. See the "Data Format Details" document for
more information. There is another format called "raw_internal", which is
used to resolve format issues in the data collected at the early stage of
this project. It is now obsolete.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.__init__">

<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

      </h3>
<div class="doc doc-contents ">
<p>Constructor.</p>
<p>See the attributes of FMSignal for the meaning of the arguments.</p>
<p><strong>NOTE</strong>: This is only for internal usage. If an FMSignalLeap object is
needed, use the class method "construct_from_file()" to load data from
a file, or use the "copy()" method to duplicate a signal.</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Constructor.</span>

<span class="sd">    See the attributes of FMSignal for the meaning of the arguments.</span>

<span class="sd">    **NOTE**: This is only for internal usage. If an FMSignalLeap object is</span>
<span class="sd">    needed, use the class method "construct_from_file()" to load data from</span>
<span class="sd">    a file, or use the "copy()" method to duplicate a signal.</span>

<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="n">cid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">seq</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tsc</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">joints</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">confs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">valids</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rotms</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.all_close_to">

<code class="highlight language-python"><span class="n">all_close_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Check whether this signal is almost identical to the other signal.</p>
<p><strong>NOTE</strong>: The criteria of "identical" is defined by "np.allclose()".
The two signals must have the same type and length.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>signal</code></td>
<td><code>FMSignalLeap</code></td>
<td>
<p>The other signal to compare.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>
<p>True if they are almost identical; False otherwise.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">all_close_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">):</span>
    <span class="sd">"""Check whether this signal is almost identical to the other signal.</span>

<span class="sd">    **NOTE**: The criteria of "identical" is defined by "np.allclose()".</span>
<span class="sd">    The two signals must have the same type and length.</span>

<span class="sd">    Args:</span>

<span class="sd">        signal (FMSignalLeap): The other signal to compare.</span>

<span class="sd">    Returns:</span>

<span class="sd">        bool: True if they are almost identical; False otherwise.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">FMSignalLeap</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="n">signal</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># NOTE: The CSV format only stores six digits after the decimal point.</span>
    <span class="c1"># Hence, "atol" can not be smaller than 1e-6.</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tsc</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">tsc</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">tip</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">joints</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">confs</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">confs</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r7</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valids</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">valids</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">r1</span> <span class="ow">and</span> <span class="n">r2</span> <span class="ow">and</span> <span class="n">r3</span> <span class="ow">and</span> <span class="n">r4</span> <span class="ow">and</span> <span class="n">r5</span> <span class="ow">and</span> <span class="n">r6</span> <span class="ow">and</span> <span class="n">r7</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.construct_from_file">

<code class="highlight language-python"><span class="n">construct_from_file</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

      </h3>
<div class="doc doc-contents ">
<p>Construct a signal by loading data from a file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fn</code></td>
<td><code>string</code></td>
<td>
<p>The file name (without extension).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>string</code></td>
<td>
<p>The file format, either "raw_csv", or "raw_npy".</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>user</code></td>
<td><code>string</code></td>
<td>
<p>The user who creates this signal.</p>
</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>cid</code></td>
<td><code>string</code></td>
<td>
<p>The unique id indicating the content of the signal.</p>
</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>seq</code></td>
<td><code>int</code></td>
<td>
<p>The sequence id in a set when loaded from a dataset.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FMSignalLeap</code></td>
<td>
<p>The constructed signal object.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the "mode" is wrong.</p>
</td>
</tr>
<tr>
<td><code>FileNotFoundError</code></td>
<td>
<p>If the file does not exist.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">construct_from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Construct a signal by loading data from a file.</span>

<span class="sd">    Args:</span>

<span class="sd">        fn (string): The file name (without extension).</span>
<span class="sd">        mode (string): The file format, either "raw_csv", or "raw_npy".</span>
<span class="sd">        user (string): The user who creates this signal.</span>
<span class="sd">        cid (string): The unique id indicating the content of the signal.</span>
<span class="sd">        seq (int): The sequence id in a set when loaded from a dataset.</span>

<span class="sd">    Returns:</span>

<span class="sd">        FMSignalLeap: The constructed signal object.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the "mode" is wrong.</span>
<span class="sd">        FileNotFoundError: If the file does not exist.</span>

<span class="sd">    """</span>

    <span class="n">signal</span> <span class="o">=</span> <span class="n">FMSignalLeap</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">seq</span><span class="p">)</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">signal</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.estimate_angular_states">

<code class="highlight language-python"><span class="n">estimate_angular_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_yaw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_pitch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_roll</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Estimate orientation, angular speed, and angular acceleration.</p>
<p><strong>NOTE</strong>: Orientations are represented as the qx, qy, and qz 
components of a unit quaternion. It is obtained by the position of the
joints of the hand.</p>
<p><strong>NOTE</strong>: Currently, the angular speed is the relative local 
differential of the angular position. The angular acceleration is just 
the differential of the angular speed, not the real angular 
acceleration. In this way, even if the reference frame changes, the
angular speed will not change. Hence, we add three purtubation angles
to change the local reference frame a bit as needed, mainly for data 
augmentation usage.</p>
<p><strong>NOTE</strong>: This method is only used in the preprocessing procedure.
This method modifies the signal. This method should be called after 
the pose normalization step.</p>
<p><strong>NOTE</strong>: Currently, this method iterates through each sample, which is
relatively slow.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>p_yaw</code></td>
<td><code>float</code></td>
<td>
<p>The pertubation yaw angle in radian.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>p_pitch</code></td>
<td><code>float</code></td>
<td>
<p>The pertubation pitch angle in radian.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>p_roll</code></td>
<td><code>float</code></td>
<td>
<p>The pertubation roll angle in radian.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">estimate_angular_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_yaw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_pitch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_roll</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Estimate orientation, angular speed, and angular acceleration.</span>

<span class="sd">    **NOTE**: Orientations are represented as the qx, qy, and qz </span>
<span class="sd">    components of a unit quaternion. It is obtained by the position of the</span>
<span class="sd">    joints of the hand.</span>

<span class="sd">    **NOTE**: Currently, the angular speed is the relative local </span>
<span class="sd">    differential of the angular position. The angular acceleration is just </span>
<span class="sd">    the differential of the angular speed, not the real angular </span>
<span class="sd">    acceleration. In this way, even if the reference frame changes, the</span>
<span class="sd">    angular speed will not change. Hence, we add three purtubation angles</span>
<span class="sd">    to change the local reference frame a bit as needed, mainly for data </span>
<span class="sd">    augmentation usage.</span>

<span class="sd">    **NOTE**: This method is only used in the preprocessing procedure.</span>
<span class="sd">    This method modifies the signal. This method should be called after </span>
<span class="sd">    the pose normalization step.</span>

<span class="sd">    **NOTE**: Currently, this method iterates through each sample, which is</span>
<span class="sd">    relatively slow.</span>

<span class="sd">    Args:</span>

<span class="sd">        p_yaw (float): The pertubation yaw angle in radian.</span>
<span class="sd">        p_pitch (float): The pertubation pitch angle in radian.</span>
<span class="sd">        p_roll (float): The pertubation roll angle in radian.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>

    <span class="c1"># rotation matrix of each data sample</span>
    <span class="n">rotms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="c1"># pose offset, for augmentation</span>
    <span class="n">R_offset</span> <span class="o">=</span> <span class="n">euler_zyx_to_rotation_matrix</span><span class="p">(</span><span class="n">p_yaw</span><span class="p">,</span> <span class="n">p_pitch</span><span class="p">,</span> <span class="n">p_roll</span><span class="p">)</span>

    <span class="c1"># quaternion of each data sample</span>
    <span class="n">qs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
    <span class="n">omega_pre</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">):</span>

        <span class="n">joints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Origin is the near end of the index finger.</span>
        <span class="c1"># p0 = joints[1, 1]</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">joints</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Pointing direction is from the near end to the next joint along</span>
        <span class="c1"># the index finger.</span>
        <span class="c1"># p1 = joints[1, 2]</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">joints</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># The side direction is from the near end of the index finger to</span>
        <span class="c1"># the near end of the little finger.</span>
        <span class="c1"># p2 = joints[4, 1]</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">joints</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c1"># derive the pose represented in three orthogonal vectors,</span>
        <span class="c1"># i.e., vx, vy, vz</span>

        <span class="c1"># Note that here vx is the general pointing direction, vz is the</span>
        <span class="c1"># general palm facing direction</span>

        <span class="n">vx</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p0</span>
        <span class="n">vy_prime</span> <span class="o">=</span> <span class="n">p0</span> <span class="o">-</span> <span class="n">p2</span>
        <span class="n">vz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy_prime</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vx</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1e-6</span><span class="p">:</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>

        <span class="c1"># most of the time the palm is facing downward, so we flip the</span>
        <span class="c1"># axes here to set up a local reference frame where the z-axis</span>
        <span class="c1"># is always upward.</span>

        <span class="c1"># CAUTION: There are chances that the sensor wrongly recognize the</span>
        <span class="c1"># right hand as the palm facing upward. Similarly, there are cases</span>
        <span class="c1"># that the right hand is wrongly identified as the left hand. In</span>
        <span class="c1"># either cases, we just always make the z-axis upward.</span>

        <span class="c1"># if vz[2] &lt; 0:</span>

        <span class="c1">#     vz = -vz</span>

        <span class="n">vy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vz</span><span class="p">,</span> <span class="n">vx</span><span class="p">)</span>
        <span class="n">vz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">)</span>

        <span class="n">vx</span> <span class="o">=</span> <span class="n">vx</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vx</span><span class="p">)</span>
        <span class="n">vy</span> <span class="o">=</span> <span class="n">vy</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vy</span><span class="p">)</span>
        <span class="n">vz</span> <span class="o">=</span> <span class="n">vz</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vz</span><span class="p">)</span>

        <span class="n">vx</span> <span class="o">=</span> <span class="n">vx</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">vy</span> <span class="o">=</span> <span class="n">vy</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">vz</span> <span class="o">=</span> <span class="n">vz</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># CAUTION: this is just an approximation of a rotation matrix,</span>
        <span class="c1"># and it may not be perfectly northonormal!!!</span>
        <span class="n">rotm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="o">.</span><span class="n">construct_from_rotation_matrix</span><span class="p">(</span><span class="n">rotm</span><span class="p">)</span>
        <span class="c1"># print(q, q.norm())</span>
        <span class="c1">#             u = rotation_matrix_to_angle_axis(rotm)</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">pv</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_vector</span><span class="p">()</span>
            <span class="n">qv</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">to_vector</span><span class="p">()</span>

            <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pv</span> <span class="o">-</span> <span class="n">qv</span><span class="p">)</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pv</span> <span class="o">+</span> <span class="n">qv</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">p1</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">:</span>

                <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">negate</span><span class="p">()</span>

        <span class="c1"># Now since it is a unit quaternion encoding the rotation, we</span>
        <span class="c1"># convert it back to a rotation matrix for future usage</span>

        <span class="c1"># rotm = q.to_rotation_matrix()</span>

        <span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>
        <span class="n">rotms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotm</span>

        <span class="c1"># Now we derive the three Tait-Bryan angles</span>
        <span class="c1"># CAUTION: yaw first, then pitch, then roll</span>
        <span class="c1"># i.e., z-y-x intrinsic rotation (east, north, sky)</span>

        <span class="c1">#             yaw, pitch, roll, gimbal_lock \</span>
        <span class="c1">#                 = rotation_matrix_to_euler_angles_zyx(rotm)</span>
        <span class="c1">#</span>
        <span class="c1">#             data[i, 9] = roll</span>
        <span class="c1">#             data[i, 10] = pitch</span>
        <span class="c1">#             data[i, 11] = yaw</span>
        <span class="c1">#</span>
        <span class="c1">#             assert not gimbal_lock</span>

        <span class="c1"># Tait-Bryan angles have singularity.</span>
        <span class="c1"># Use quaternion components instead.</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">x</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">y</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">z</span>

        <span class="c1">#             data[i, 9:12] = u</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">timestep</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">ts</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">timestep</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="n">p</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">omega</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="o">.</span><span class="n">differentiate_local</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">omega</span> <span class="o">=</span> <span class="n">omega_pre</span>

            <span class="n">omega_pre</span> <span class="o">=</span> <span class="n">omega</span>

            <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">omega</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>
            <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">omega</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>
            <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="n">omega</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>

    <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>

    <span class="n">ov</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    <span class="n">ov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R_offset</span><span class="p">,</span> <span class="n">ov</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[:,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">ov</span><span class="o">.</span><span class="n">T</span>

    <span class="n">data</span><span class="p">[:,</span> <span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">12</span><span class="p">])</span>
    <span class="n">data</span><span class="p">[:,</span> <span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">13</span><span class="p">])</span>
    <span class="n">data</span><span class="p">[:,</span> <span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">14</span><span class="p">])</span>

    <span class="c1">#print(data.dtype)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="mi">18</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">rotms</span> <span class="o">=</span> <span class="n">rotms</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.estimate_linear_states">

<code class="highlight language-python"><span class="n">estimate_linear_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Estimate position, velocity and acceleration.</p>
<p><strong>NOTE</strong>: For the Leap Motion device, only the position is directly
obtained from the device. The velocity and acceleration are derived
by differentiating the the position.</p>
<p><strong>NOTE</strong>: This method is only used in the preprocessing procedure.
This method modifies the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>point</code></td>
<td><code>string</code></td>
<td>
<p>The point on the hand, either "tip" or "center".</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">estimate_linear_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
    <span class="sd">"""Estimate position, velocity and acceleration.</span>

<span class="sd">    **NOTE**: For the Leap Motion device, only the position is directly</span>
<span class="sd">    obtained from the device. The velocity and acceleration are derived</span>
<span class="sd">    by differentiating the the position.</span>

<span class="sd">    **NOTE**: This method is only used in the preprocessing procedure.</span>
<span class="sd">    This method modifies the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        point (string): The point on the hand, either "tip" or "center".</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="c1"># print(data.dtype)</span>

    <span class="k">if</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">"tip"</span><span class="p">:</span>

        <span class="c1"># Use the tip of the index finger.</span>
        <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">"center"</span><span class="p">:</span>

        <span class="c1"># Use the center of the palm.</span>
        <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown point type: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="p">))</span>

    <span class="n">data</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">data</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">data</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>

    <span class="n">data</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">data</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">])</span>
    <span class="n">data</span><span class="p">[:,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">])</span>

    <span class="c1"># print(data.dtype)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.filter">

<code class="highlight language-python"><span class="nb">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_freq</span><span class="p">,</span> <span class="n">cut_freq</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Low-pass filtering on the signal.</p>
<p><strong>NOTE</strong>: It is assumed that a hand can not move in very high frequency,
so the high frequency components of the signal is filtered. This method
uses NumPy FFT and IFFT.</p>
<p><strong>NOTE</strong>: This method is only used in the preprocessing procedure.
This method modifies the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sample_freq</code></td>
<td><code>float</code></td>
<td>
<p>sample frequency of this signal.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>cut_freq</code></td>
<td><code>float</code></td>
<td>
<p>low pass filtering cutoff frequency.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_freq</span><span class="p">,</span> <span class="n">cut_freq</span><span class="p">):</span>
    <span class="sd">"""Low-pass filtering on the signal.</span>

<span class="sd">    **NOTE**: It is assumed that a hand can not move in very high frequency,</span>
<span class="sd">    so the high frequency components of the signal is filtered. This method</span>
<span class="sd">    uses NumPy FFT and IFFT.</span>

<span class="sd">    **NOTE**: This method is only used in the preprocessing procedure.</span>
<span class="sd">    This method modifies the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        sample_freq (float): sample frequency of this signal.</span>
<span class="sd">        cut_freq (float): low pass filtering cutoff frequency.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="n">cut_l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cut_freq</span> <span class="o">*</span> <span class="n">l</span> <span class="o">/</span> <span class="n">sample_freq</span><span class="p">)</span>

    <span class="n">dft_co</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cut_l</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="n">cut_l</span><span class="p">):</span>

        <span class="n">dft_co</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span>

    <span class="n">ifft_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">dft_co</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># NOTE: This must be converted to "np.float32"!</span>
    <span class="n">ifft</span> <span class="o">=</span> <span class="n">ifft_c</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1">#print(ifft.dtype)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">ifft</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.fix_missing_samples">

<code class="highlight language-python"><span class="n">fix_missing_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Fix missing data samples by linear interpolation.</p>
<p><strong>NOTE</strong>: This is only for internal usage. The missing samples are 
mainly caused by the motion of the hand which are outside the field of 
the view of the sensor. This procedure assumes that the first sample is
always valid! Since it uses linear interpolation, it will not work well
with too many missing samples. </p>
<p><strong>NOTE</strong>: This method is only used in the preprocessing procedure.
This method modifies the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td><code>None</code></td>
<td>
<p>No argument.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">fix_missing_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Fix missing data samples by linear interpolation.</span>

<span class="sd">    **NOTE**: This is only for internal usage. The missing samples are </span>
<span class="sd">    mainly caused by the motion of the hand which are outside the field of </span>
<span class="sd">    the view of the sensor. This procedure assumes that the first sample is</span>
<span class="sd">    always valid! Since it uses linear interpolation, it will not work well</span>
<span class="sd">    with too many missing samples. </span>

<span class="sd">    **NOTE**: This method is only used in the preprocessing procedure.</span>
<span class="sd">    This method modifies the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        None (None): No argument.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>


<span class="sd">    """</span>

    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>

        <span class="c1"># Find the start index of a missing segment.</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Find the end index of a missing segment.</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valids</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># If missing points found between i and j, fix them.</span>
        <span class="c1"># If no missing point found, just skip.</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>

            <span class="c1"># print(i, j)</span>

            <span class="n">start_ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">end_ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

            <span class="n">start_tip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">end_tip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">length_tip</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_tip</span> <span class="o">-</span> <span class="n">start_tip</span><span class="p">)</span>

            <span class="n">start_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">end_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">length_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_center</span> <span class="o">-</span> <span class="n">start_center</span><span class="p">)</span>

            <span class="n">start_joints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">end_joints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">length_joints</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_joints</span> <span class="o">-</span> <span class="n">start_joints</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>

                <span class="n">k_ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_ts</span> <span class="o">-</span> <span class="n">start_ts</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">end_ts</span> <span class="o">-</span> <span class="n">start_ts</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_tip</span> <span class="o">+</span> <span class="n">length_tip</span> <span class="o">*</span> <span class="n">rate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_center</span> <span class="o">+</span> <span class="n">length_center</span> <span class="o">*</span> <span class="n">rate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_joints</span> <span class="o">+</span> <span class="n">length_joints</span> <span class="o">*</span> <span class="n">rate</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">valids</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># Find another missing sement in the next iteration</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">j</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.load_from_buffer_raw">

<code class="highlight language-python"><span class="n">load_from_buffer_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Load data from a NumPy ndarray.</p>
<p><strong>NOTE</strong>: This is only for internal usage.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>array</code></td>
<td><code>ndarray</code></td>
<td>
<p>The buffer.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">load_from_buffer_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
    <span class="sd">"""Load data from a NumPy ndarray.</span>

<span class="sd">    **NOTE**: This is only for internal usage.</span>

<span class="sd">    Args:</span>

<span class="sd">        array (ndarray): The buffer.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">l</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">75</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"Wrong raw file format: m = </span><span class="si">%d</span><span class="s2">"</span> <span class="o">%</span> <span class="n">m</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">l</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tsc</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="n">offset_tip</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">offset_center</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span>
    <span class="n">offset_joints</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="n">offset_tip</span> <span class="p">:</span> <span class="n">offset_tip</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="n">offset_center</span> <span class="p">:</span> <span class="n">offset_center</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span>

    <span class="c1"># Load joint positions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">joints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">offset_joints</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="mi">3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="n">index</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span>

    <span class="c1"># Load confidences and valid flags</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">confs</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">valids</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.load_from_buffer_raw_internal">

<code class="highlight language-python"><span class="n">load_from_buffer_raw_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Load data from a NumPy ndarray in the "raw_internal" format.</p>
<p><strong>NOTE</strong>: This is only for internal usage.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>array</code></td>
<td><code>ndarray</code></td>
<td>
<p>The buffer.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No Return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">load_from_buffer_raw_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
    <span class="sd">"""Load data from a NumPy ndarray in the "raw_internal" format.</span>

<span class="sd">    **NOTE**: This is only for internal usage.</span>

<span class="sd">    Args:</span>

<span class="sd">        array (ndarray): The buffer.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No Return value.</span>


<span class="sd">    """</span>

    <span class="n">l</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


    <span class="c1"># --------- process timestamp ------</span>

    <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">133</span> <span class="ow">or</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">93</span><span class="p">:</span>

        <span class="c1"># NOTE: This is the old format, with only one timestamp.</span>
        <span class="n">offset_base</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">tsc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">134</span><span class="p">:</span>

        <span class="c1"># CATUION: the current format, with two timestamps.</span>
        <span class="n">offset_base</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">tsc</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="c1"># Use an offset to reduce the size of tsc so that it can fit into</span>
        <span class="c1"># the float32 type.</span>
        <span class="n">tsc</span> <span class="o">-=</span> <span class="mi">1514764800</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown data file format!: m = </span><span class="si">%d</span><span class="s2">"</span> <span class="o">%</span> <span class="n">m</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>

        <span class="c1"># fix timestamp wraping over maximum of uint32</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ts</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">4294967295.0</span>

    <span class="c1"># Fix timestamp offset and convert timestamp to millisecond</span>
    <span class="c1"># CAUTION: timestamp must start from 0! Other methods such as filtering</span>
    <span class="c1"># depend on this assumption!</span>
    <span class="n">ts0</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ts</span> <span class="o">-=</span> <span class="n">ts0</span>
    <span class="n">ts</span> <span class="o">/=</span> <span class="mi">1000</span>

    <span class="c1"># --------- process point coordinate and joint coordinate ------</span>

    <span class="n">offset_tip</span> <span class="o">=</span> <span class="n">offset_base</span>
    <span class="n">offset_center</span> <span class="o">=</span> <span class="n">offset_base</span> <span class="o">+</span> <span class="mi">6</span>
    <span class="n">offset_joints</span> <span class="o">=</span> <span class="n">offset_base</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">9</span>

    <span class="n">data_tip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="c1"># NOTE: Axes mapping: yzx -&gt; xyz</span>
    <span class="n">data_tip</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="n">offset_tip</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">data_tip</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="n">offset_tip</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">data_tip</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="n">offset_tip</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">data_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="c1"># NOTE: Axes mapping: yzx -&gt; xyz</span>
    <span class="n">data_center</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="n">offset_center</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">data_center</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="n">offset_center</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">data_center</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="n">offset_center</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">data_joints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># Load joint positions</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="mi">3</span>
            <span class="c1"># NOTE: Axes mapping: yzx -&gt; xyz</span>
            <span class="n">data_joints</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="n">offset_joints</span> <span class="o">+</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">data_joints</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="n">offset_joints</span> <span class="o">+</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">data_joints</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="n">offset_joints</span> <span class="o">+</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Load confidences and valid flags</span>
    <span class="n">confs</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">valids</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">l</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tsc</span> <span class="o">=</span> <span class="n">tsc</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="n">data_tip</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">data_center</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">joints</span> <span class="o">=</span> <span class="n">data_joints</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">confs</span> <span class="o">=</span> <span class="n">confs</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">valids</span> <span class="o">=</span> <span class="n">valids</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.load_from_file">

<code class="highlight language-python"><span class="n">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>General interface to load the raw signal from a file.</p>
<p><strong>NOTE</strong>: This is only for internal usage. If an FMSignalLeap object is
needed, use the class method "construct_from_file()" instead.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fn</code></td>
<td><code>string</code></td>
<td>
<p>The file name (without the ".csv" or ".npy" extension).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>string</code></td>
<td>
<p>The file format, either "raw_csv", or "raw_npy".</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>if the "mode" is unknown.</p>
</td>
</tr>
<tr>
<td><code>FileNotFoundError</code></td>
<td>
<p>if the file does not exist.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">"""General interface to load the raw signal from a file.</span>

<span class="sd">    **NOTE**: This is only for internal usage. If an FMSignalLeap object is</span>
<span class="sd">    needed, use the class method "construct_from_file()" instead.</span>

<span class="sd">    Args:</span>

<span class="sd">        fn (string): The file name (without the ".csv" or ".npy" extension).</span>
<span class="sd">        mode (string): The file format, either "raw_csv", or "raw_npy".</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: if the "mode" is unknown.</span>
<span class="sd">        FileNotFoundError: if the file does not exist.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"raw_internal"</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".txt"</span>
        <span class="c1"># NOTE: The "dtype" needs to be np.float64 for the raw timestamps!</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_from_buffer_raw_internal</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"raw_csv"</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".csv"</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_from_buffer_raw</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"raw_npy"</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".npy"</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_from_buffer_raw</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown file mode </span><span class="si">%s</span><span class="s2">!"</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.pose_normalize">

<code class="highlight language-python"><span class="n">pose_normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">p_yaw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_pitch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_roll</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Normalize the position and orientation of the signal.</p>
<p><strong>NOTE</strong>: The new x-axis is the average of the pointing direction,
the new z-axis is the vertical up direction of the leap motion sensor
(assuming the sensor is placed on a horizontal surface), and the new 
y-axis is determined by the new x-axis and y-axis.</p>
<p><strong>NOTE</strong>: The three angles in the argument are offsets that applied 
during the normalization in radians. This can be used in orientation
purtubation for data augmentation or correcting the pointing direction.</p>
<p><strong>NOTE</strong>: This method is only used in the preprocessing procedure.
This method modifies the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>point</code></td>
<td><code>string</code></td>
<td>
<p>The point on the hand, either "tip" or "center".</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>start</code></td>
<td><code>int</code></td>
<td>
<p>The start time index of the signal for normalization.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>end</code></td>
<td><code>int</code></td>
<td>
<p>The end time index of the signal for normalization.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>p_yaw</code></td>
<td><code>float</code></td>
<td>
<p>The pertubation yaw angle in radian.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>p_pitch</code></td>
<td><code>float</code></td>
<td>
<p>The pertubation pitch angle in radian.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>p_roll</code></td>
<td><code>float</code></td>
<td>
<p>The pertubation roll angle in radian.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the "point" is wrong or the "start" or "end" is bad.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">pose_normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">p_yaw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_pitch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_roll</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Normalize the position and orientation of the signal.</span>

<span class="sd">    **NOTE**: The new x-axis is the average of the pointing direction,</span>
<span class="sd">    the new z-axis is the vertical up direction of the leap motion sensor</span>
<span class="sd">    (assuming the sensor is placed on a horizontal surface), and the new </span>
<span class="sd">    y-axis is determined by the new x-axis and y-axis.</span>

<span class="sd">    **NOTE**: The three angles in the argument are offsets that applied </span>
<span class="sd">    during the normalization in radians. This can be used in orientation</span>
<span class="sd">    purtubation for data augmentation or correcting the pointing direction.</span>

<span class="sd">    **NOTE**: This method is only used in the preprocessing procedure.</span>
<span class="sd">    This method modifies the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        point (string): The point on the hand, either "tip" or "center".</span>
<span class="sd">        start (int): The start time index of the signal for normalization.</span>
<span class="sd">        end (int): The end time index of the signal for normalization.</span>
<span class="sd">        p_yaw (float): The pertubation yaw angle in radian.</span>
<span class="sd">        p_pitch (float): The pertubation pitch angle in radian.</span>
<span class="sd">        p_roll (float): The pertubation roll angle in radian.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the "point" is wrong or the "start" or "end" is bad.</span>

<span class="sd">    """</span>

    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">end</span> <span class="o">&gt;=</span> <span class="n">l</span> <span class="ow">and</span> <span class="n">end</span> <span class="o">&lt;=</span> <span class="n">start</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Bad start and end indices: </span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">."</span> \
            <span class="o">%</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>

    <span class="c1"># Find the average position.</span>

    <span class="k">if</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">"tip"</span><span class="p">:</span>

        <span class="c1"># Use the tip of the index finger.</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">"center"</span><span class="p">:</span>

        <span class="c1"># Use the center of the palm.</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown point type: </span><span class="si">%s</span><span class="s2">."</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="p">))</span>

    <span class="n">pos_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Position normalization.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">-</span><span class="n">pos_mean</span><span class="p">)</span>

    <span class="c1"># Find the average orientation.</span>

    <span class="n">data_joints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span>

    <span class="k">if</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">"tip"</span><span class="p">:</span>

        <span class="c1"># Use the direction of the middle segment of the index finger.</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">data_joints</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">data_joints</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">elif</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">"center"</span><span class="p">:</span>

        <span class="c1"># Use the direction of the last segment of the middle finger.</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">data_joints</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">data_joints</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown point type: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="p">))</span>

    <span class="n">vx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">vz_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vz_t</span><span class="p">,</span> <span class="n">vx</span><span class="p">)</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">)</span>

    <span class="n">vx</span> <span class="o">=</span> <span class="n">vx</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vx</span><span class="p">)</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="n">vy</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vy</span><span class="p">)</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="n">vz</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vz</span><span class="p">)</span>

    <span class="n">vx</span> <span class="o">=</span> <span class="n">vx</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="n">vy</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="n">vz</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Orientation normalization.</span>
    <span class="c1"># NOTE: "p_yaw", "p_pitch", "p_roll" are orientation pertubation. They</span>
    <span class="c1"># are all in radian.</span>

    <span class="n">R_g2l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">R_l2g</span> <span class="o">=</span> <span class="n">R_g2l</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="n">R_offset</span> <span class="o">=</span> <span class="n">euler_zyx_to_rotation_matrix</span><span class="p">(</span><span class="n">p_yaw</span><span class="p">,</span> <span class="n">p_pitch</span><span class="p">,</span> <span class="n">p_roll</span><span class="p">)</span>

    <span class="n">R_l2g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R_offset</span><span class="p">,</span> <span class="n">R_l2g</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">R_l2g</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.prepare_trim_by_velocity">

<code class="highlight language-python"><span class="n">prepare_trim_by_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Determine the indicies for the start and end of the finger motion.</p>
<p><strong>NOTE</strong>: The trimming process is split into two parts to accommodate
other preprocessing steps. This method is the first part, which returns
the start and end indices without actually throwing away the data 
samples when the hand is not moving.</p>
<p><strong>NOTE</strong>: This method is only used in the preprocessing procedure.
This method <strong>DOES NOT</strong> modify the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>point</code></td>
<td><code>string</code></td>
<td>
<p>The point on the hand, either "tip" or "center".</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>threshold</code></td>
<td><code>float</code></td>
<td>
<p>Threshold to detect the hand motion.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>NOTE</strong>: The threshold is relative. Typically some value between 0.2 
to 0.5 would be good enough.</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">prepare_trim_by_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
    <span class="sd">"""Determine the indicies for the start and end of the finger motion.</span>

<span class="sd">    **NOTE**: The trimming process is split into two parts to accommodate</span>
<span class="sd">    other preprocessing steps. This method is the first part, which returns</span>
<span class="sd">    the start and end indices without actually throwing away the data </span>
<span class="sd">    samples when the hand is not moving.</span>

<span class="sd">    **NOTE**: This method is only used in the preprocessing procedure.</span>
<span class="sd">    This method **DOES NOT** modify the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        point (string): The point on the hand, either "tip" or "center".</span>
<span class="sd">        threshold (float): Threshold to detect the hand motion.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    **NOTE**: The threshold is relative. Typically some value between 0.2 </span>
<span class="sd">    to 0.5 would be good enough.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">"tip"</span><span class="p">:</span>

        <span class="c1"># Use the tip of the index finger.</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span>

    <span class="k">elif</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">"center"</span><span class="p">:</span>

        <span class="c1"># Use the center of the palm.</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown point type: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="p">))</span>

    <span class="n">vel</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="c1"># The "start" and "end" are determined by the relative velocity. It is </span>
    <span class="c1"># calculated here by taking gradient of the position and then </span>
    <span class="c1"># normalizing it.</span>
    <span class="n">vel</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">vel</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">vel</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">v_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="c1"># NOTE: We cannot subtract the mean of velocity here.</span>
    <span class="n">vn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v_std</span><span class="p">)</span>

    <span class="c1"># Determine the start</span>
    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vn</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">5</span>
            <span class="k">break</span>
    <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vn</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span>
            <span class="k">break</span>
    <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>

    <span class="c1"># print(self.id_label, self.seq, l, start, l - end)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.preprocess">

<code class="highlight language-python"><span class="n">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">cut_freq</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">re_freq</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">p_yaw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_pitch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_roll</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Preprocess the signal.</p>
<p><strong>NOTE</strong>: This method follows all the preprocessing steps. See the
"Data Processing" document for details.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>point</code></td>
<td><code>string</code></td>
<td>
<p>The point on the hand, either "tip" or "center".</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>threshold</code></td>
<td><code>float</code></td>
<td>
<p>Threshold to trim the signal without hand motion.</p>
</td>
<td><code>0.2</code></td>
</tr>
<tr>
<td><code>cut_freq</code></td>
<td><code>float</code></td>
<td>
<p>Low pass filtering cutoff frequency.</p>
</td>
<td><code>10</code></td>
</tr>
<tr>
<td><code>re_freq</code></td>
<td><code>float</code></td>
<td>
<p>Resampling frequency.</p>
</td>
<td><code>50</code></td>
</tr>
<tr>
<td><code>p_yaw</code></td>
<td><code>float</code></td>
<td>
<p>The pertubation yaw angle in radian.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>p_pitch</code></td>
<td><code>float</code></td>
<td>
<p>The pertubation pitch angle in radian.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>p_roll</code></td>
<td><code>float</code></td>
<td>
<p>The pertubation roll angle in radian.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FMSignal</code></td>
<td>
<p>The preprocessed signal.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>NOTE</strong>: The default argument values are typically good enough.</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">cut_freq</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">re_freq</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
               <span class="n">p_yaw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_pitch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_roll</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Preprocess the signal.</span>

<span class="sd">    **NOTE**: This method follows all the preprocessing steps. See the</span>
<span class="sd">    "Data Processing" document for details.</span>

<span class="sd">    Args:</span>

<span class="sd">        point (string): The point on the hand, either "tip" or "center".</span>
<span class="sd">        threshold (float): Threshold to trim the signal without hand motion.</span>
<span class="sd">        cut_freq (float): Low pass filtering cutoff frequency.</span>
<span class="sd">        re_freq (float): Resampling frequency.</span>
<span class="sd">        p_yaw (float): The pertubation yaw angle in radian.</span>
<span class="sd">        p_pitch (float): The pertubation pitch angle in radian.</span>
<span class="sd">        p_roll (float): The pertubation roll angle in radian.</span>

<span class="sd">    Returns:</span>

<span class="sd">        FMSignal: The preprocessed signal.</span>

<span class="sd">    **NOTE**: The default argument values are typically good enough.</span>

<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">fix_missing_samples</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">re_freq</span><span class="p">)</span>

    <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_trim_by_velocity</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">pose_normalize</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">p_yaw</span><span class="p">,</span> <span class="n">p_pitch</span><span class="p">,</span> <span class="n">p_roll</span><span class="p">)</span>

    <span class="c1"># For the Leap Motion device, position is directly observable.</span>

    <span class="n">dim</span> <span class="o">=</span> <span class="mi">18</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">dim</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">estimate_linear_states</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">estimate_angular_states</span><span class="p">(</span><span class="n">p_yaw</span><span class="p">,</span> <span class="n">p_pitch</span><span class="p">,</span> <span class="n">p_roll</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">re_freq</span><span class="p">,</span> <span class="n">cut_freq</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>

    <span class="n">signal</span> <span class="o">=</span> <span class="n">FMSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">signal</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.resample">

<code class="highlight language-python"><span class="n">resample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">re_freq</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Resample the signal at a specified frequency.</p>
<p><strong>NOTE</strong>: This method is only used in the preprocessing procedure.
This method modifies the signal. This method uses linear interpolation
for resampling.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>re_freq</code></td>
<td><code>float</code></td>
<td>
<p>Resampling frequency.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">resample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">re_freq</span><span class="p">):</span>
    <span class="sd">"""Resample the signal at a specified frequency.</span>

<span class="sd">    **NOTE**: This method is only used in the preprocessing procedure.</span>
<span class="sd">    This method modifies the signal. This method uses linear interpolation</span>
<span class="sd">    for resampling.</span>

<span class="sd">    Args:</span>

<span class="sd">        re_freq (float): Resampling frequency.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>
    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="n">duration</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">step</span> <span class="o">=</span> <span class="mf">1000.0</span> <span class="o">/</span> <span class="n">re_freq</span>
    <span class="n">l_new</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">/</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">re_freq</span><span class="p">)</span>

    <span class="n">ts_re</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span> <span class="o">*</span> <span class="n">l_new</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">a_tip_re</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">l_new</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">a_tip_re</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ts_re</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>

    <span class="n">a_center_re</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">l_new</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">a_center_re</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ts_re</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>

    <span class="n">data_joints_re</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">l_new</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">data_joints_re</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
                    <span class="n">ts_re</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">]</span>
                <span class="p">)</span>

    <span class="n">confs_resample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ts_re</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">confs</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">valids_resample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">l_new</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># NOTE: Make sure they all have "dtype == np.float32"!</span>
    <span class="c1"># print(ts_re.dtype)</span>
    <span class="c1"># print(a_tip_re.dtype)</span>
    <span class="c1"># print(a_center_re.dtype)</span>
    <span class="c1"># print(data_joints_re.dtype)</span>
    <span class="c1"># print(confs_resample.dtype)</span>
    <span class="c1"># print(valids_resample.dtype)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">l_new</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts_re</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="n">a_tip_re</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">a_center_re</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">joints</span> <span class="o">=</span> <span class="n">data_joints_re</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">confs</span> <span class="o">=</span> <span class="n">confs_resample</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">valids</span> <span class="o">=</span> <span class="n">valids_resample</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.rotate">

<code class="highlight language-python"><span class="n">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Rotate the signal coorindate reference frame.</p>
<p><strong>NOTE</strong>: This method is only used in the preprocessing procedure.
This method modifies the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>R</code></td>
<td><code>ndarray</code></td>
<td>
<p>The 3-by-3 rotation matrix.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
    <span class="sd">"""Rotate the signal coorindate reference frame.</span>

<span class="sd">    **NOTE**: This method is only used in the preprocessing procedure.</span>
<span class="sd">    This method modifies the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        R (ndarray): The 3-by-3 rotation matrix.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">pv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    <span class="n">pv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">pv</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">T</span>

    <span class="n">pv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    <span class="n">pv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">pv</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">T</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>

            <span class="n">pv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
            <span class="n">pv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">pv</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">T</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.save_to_buffer_raw">

<code class="highlight language-python"><span class="n">save_to_buffer_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Save the raw signal to a NumPy ndarray.</p>
<p><strong>NOTE</strong>: This is only for internal usage.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td><code>None</code></td>
<td>
<p>No argument.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ndarray</code></td>
<td>
<p>The buffer.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">save_to_buffer_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Save the raw signal to a NumPy ndarray.</span>

<span class="sd">    **NOTE**: This is only for internal usage.</span>

<span class="sd">    Args:</span>

<span class="sd">        None (None): No argument.</span>

<span class="sd">    Returns:</span>

<span class="sd">        ndarray: The buffer.</span>

<span class="sd">    """</span>

    <span class="n">m</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">75</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsc</span>
    <span class="n">array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>

    <span class="n">offset_tip</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">offset_center</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span>
    <span class="n">offset_joints</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span>

    <span class="n">array</span><span class="p">[:,</span> <span class="n">offset_tip</span> <span class="p">:</span> <span class="n">offset_tip</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span>
    <span class="n">array</span><span class="p">[:,</span> <span class="n">offset_center</span> <span class="p">:</span> <span class="n">offset_center</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">offset_joints</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="mi">3</span>

            <span class="n">array</span><span class="p">[:,</span> <span class="n">index</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="p">:]</span>

    <span class="n">array</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confs</span>
    <span class="n">array</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valids</span>

    <span class="k">return</span> <span class="n">array</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.save_to_file">

<code class="highlight language-python"><span class="n">save_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>General interface to save the raw signal to a file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fn</code></td>
<td><code>string</code></td>
<td>
<p>The file name (without the ".csv" or ".npy" extension).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>string</code></td>
<td>
<p>The file format, either "raw_csv", or "raw_npy".</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">save_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">"""General interface to save the raw signal to a file.</span>

<span class="sd">    Args:</span>

<span class="sd">        fn (string): The file name (without the ".csv" or ".npy" extension).</span>
<span class="sd">        mode (string): The file format, either "raw_csv", or "raw_npy".</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"raw_csv"</span><span class="p">:</span>

        <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_to_buffer_raw</span><span class="p">()</span>
        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".csv"</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">"</span><span class="si">%.6f</span><span class="s2">"</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">", "</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"raw_npy"</span><span class="p">:</span>

        <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_to_buffer_raw</span><span class="p">()</span>
        <span class="c1"># NOTE: NumPy library add the ".npy" file extension for us!</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown file mode </span><span class="si">%s</span><span class="s2">!"</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.translate">

<code class="highlight language-python"><span class="n">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Translate the signal coorindate reference frame.</p>
<p><strong>NOTE</strong>: This method is only used in the preprocessing procedure.
This method modifies the signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>t</code></td>
<td><code>ndarray</code></td>
<td>
<p>The 3D translation vector.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sd">"""Translate the signal coorindate reference frame.</span>

<span class="sd">    **NOTE**: This method is only used in the preprocessing procedure.</span>
<span class="sd">    This method modifies the signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        t (ndarray): The 3D translation vector.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">+=</span> <span class="n">t</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">+=</span> <span class="n">t</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">t</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalLeap.trim">

<code class="highlight language-python"><span class="n">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Trim the start and the end where the hand does not move.</p>
<p><strong>NOTE</strong>: The trimming process is split into two parts to accommodate
other steps of preprocessing. This method is the second part, which 
throws away the data samples given the start and end indices.</p>
<p><strong>NOTE</strong>: This method is only used in the preprocessing procedure.
This method modifies the signal.</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="sd">"""Trim the start and the end where the hand does not move.</span>

<span class="sd">    **NOTE**: The trimming process is split into two parts to accommodate</span>
<span class="sd">    other steps of preprocessing. This method is the second part, which </span>
<span class="sd">    throws away the data samples given the start and end indices.</span>

<span class="sd">    **NOTE**: This method is only used in the preprocessing procedure.</span>
<span class="sd">    This method modifies the signal.</span>

<span class="sd">    """</span>

    <span class="n">l_new</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>

    <span class="c1"># NOTE: These "copy()" force the "ts" and "data" to have proper C-like</span>
    <span class="c1"># array in memory, which is crucial for "dtw_c()"!!!</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">ts0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">-=</span> <span class="n">ts0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">l_new</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qs</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotms</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tip</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">joints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">confs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confs</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">valids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valids</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</code></pre>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="fmsignal.FMSignalTemplate">

        <code>FMSignalTemplate</code>



      </h2>
<div class="doc doc-contents ">
<p>FMSignal signal template constructed from a collection of signals.</p>
<p>In most cases, template is identical to a signal (preprocessed, sensor
agnostic) with a few additional attributes. Note that this class is derived
from the class "FMSignal".</p>
<p><strong>Attributes:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>variance</code></td>
<td><code>ndarray</code></td>
<td>
<p>The variance of the signal (length * 18 matrix).</p>
</td>
</tr>
<tr>
<td><code>signals_aligned</code></td>
<td><code>ndarray</code></td>
<td>
<p>The signals for constructing the template.   </p>
</td>
</tr>
</tbody>
</table>
<p><strong>NOTE</strong>: The variance is calculates at sample level, so it has the same
length and dimension as the data, i.e., a length * 18 matrix.</p>
<p><strong>NOTE</strong>: The "signals_aligned" is only valid if it is constructed from a
collection of signals, i.e., by calling "construct_from_signals()". It is
not valid if the template is loaded from a file.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalTemplate.__init__">

<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signals_aligned</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

      </h3>
<div class="doc doc-contents ">
<p>Constructor.</p>
<p>See the attributes of FMSignal for the meaning of the arguments.</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
             <span class="n">variance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signals_aligned</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Constructor.</span>

<span class="sd">    See the attributes of FMSignal for the meaning of the arguments.</span>

<span class="sd">    """</span>

    <span class="n">FMSignal</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">seq</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="n">variance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">signals_aligned</span> <span class="o">=</span> <span class="n">signals_aligned</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalTemplate.all_close_to">

<code class="highlight language-python"><span class="n">all_close_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Check whether this template is almost identical to another template.</p>
<p><strong>NOTE</strong>: The criteria of "identical" is defined by "np.allclose()".
The two templates must have the same type and length.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>template</code></td>
<td><code>FMSignalTemplate</code></td>
<td>
<p>The other template to compare.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>
<p>True if they are almost identical; False otherwise.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">all_close_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">):</span>
    <span class="sd">"""Check whether this template is almost identical to another template.</span>

<span class="sd">    **NOTE**: The criteria of "identical" is defined by "np.allclose()".</span>
<span class="sd">    The two templates must have the same type and length.</span>

<span class="sd">    Args:</span>

<span class="sd">        template (FMSignalTemplate): The other template to compare.</span>

<span class="sd">    Returns:</span>

<span class="sd">        bool: True if they are almost identical; False otherwise.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">FMSignal</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="n">template</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># NOTE: The CSV format only stores six digits after the decimal point.</span>
    <span class="c1"># Hence, "atol" can not be smaller than 1e-6.</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">template</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">template</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="n">r3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">,</span> <span class="n">template</span><span class="o">.</span><span class="n">variance</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">r1</span> <span class="ow">and</span> <span class="n">r2</span> <span class="ow">and</span> <span class="n">r3</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalTemplate.construct_from_file">

<code class="highlight language-python"><span class="n">construct_from_file</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

      </h3>
<div class="doc doc-contents ">
<p>Factory method to build the signal by loading a file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fn</code></td>
<td><code>string</code></td>
<td>
<p>The file name (without extension).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>string</code></td>
<td>
<p>The file format, either "raw_csv", or "raw_npy".</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>user</code></td>
<td><code>string</code></td>
<td>
<p>The user who creates this signal.</p>
</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>cid</code></td>
<td><code>string</code></td>
<td>
<p>The unique id indicating the content of the signal.</p>
</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>seq</code></td>
<td><code>int</code></td>
<td>
<p>The sequence id in a set when loaded from a dataset.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FMSignalTemplate</code></td>
<td>
<p>The constructed signal object.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the "mode" is wrong.</p>
</td>
</tr>
<tr>
<td><code>FileNotFoundError</code></td>
<td>
<p>If the file does not exist.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">construct_from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Factory method to build the signal by loading a file.</span>

<span class="sd">    Args:</span>

<span class="sd">        fn (string): The file name (without extension).</span>
<span class="sd">        mode (string): The file format, either "raw_csv", or "raw_npy".</span>
<span class="sd">        user (string): The user who creates this signal.</span>
<span class="sd">        cid (string): The unique id indicating the content of the signal.</span>
<span class="sd">        seq (int): The sequence id in a set when loaded from a dataset.</span>

<span class="sd">    Returns:</span>

<span class="sd">        FMSignalTemplate: The constructed signal object.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the "mode" is wrong.</span>
<span class="sd">        FileNotFoundError: If the file does not exist.</span>

<span class="sd">    """</span>

    <span class="n">template</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>

    <span class="n">template</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

    <span class="n">template</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="n">template</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="n">cid</span>
    <span class="n">template</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">seq</span>


    <span class="k">return</span> <span class="n">template</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalTemplate.construct_from_signals">

<code class="highlight language-python"><span class="n">construct_from_signals</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">template_index</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

      </h3>
<div class="doc doc-contents ">
<p>Construct the template by aligning and average a set of signals.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>signals</code></td>
<td><code>list</code></td>
<td>
<p>The collection of signals (FMSignal objects).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>template_index</code></td>
<td><code>int</code></td>
<td>
<p>The index indicating the alignment.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>window</code></td>
<td><code>int</code></td>
<td>
<p>Alignment window, see "dtw()".</p>
</td>
<td><code>50</code></td>
</tr>
<tr>
<td><code>penalty</code></td>
<td><code>int</code></td>
<td>
<p>Element-wise misalignment penalty, see "dtw()".</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>NOTE</strong>: The "signals" should be a collection of signals</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">construct_from_signals</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">signals</span><span class="p">,</span> <span class="n">template_index</span><span class="p">,</span> 
                           <span class="n">window</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Construct the template by aligning and average a set of signals.</span>

<span class="sd">    Args:</span>

<span class="sd">        signals (list): The collection of signals (FMSignal objects).</span>
<span class="sd">        template_index (int): The index indicating the alignment.</span>
<span class="sd">        window (int): Alignment window, see "dtw()".</span>
<span class="sd">        penalty (int): Element-wise misalignment penalty, see "dtw()".</span>

<span class="sd">    **NOTE**: The "signals" should be a collection of signals</span>

<span class="sd">    """</span>

    <span class="n">signal_t</span> <span class="o">=</span> <span class="n">signals</span><span class="p">[</span><span class="n">template_index</span><span class="p">]</span>
    <span class="n">signals_aligned</span> <span class="o">=</span> <span class="p">[</span><span class="n">signal_t</span><span class="p">]</span>

    <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">signals</span><span class="p">)</span>

    <span class="c1"># construct signal template</span>

    <span class="n">length</span> <span class="o">=</span> <span class="n">signal_t</span><span class="o">.</span><span class="n">length</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="n">signal_t</span><span class="o">.</span><span class="n">dim</span>

    <span class="n">ts</span> <span class="o">=</span> <span class="n">signal_t</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">signal_t</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">signal_t</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">signal_t</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">signal</span> <span class="ow">in</span> <span class="n">signals</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">signal</span> <span class="o">==</span> <span class="n">signal_t</span><span class="p">:</span>

            <span class="k">continue</span>

        <span class="n">signal_aligned</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">align_to</span><span class="p">(</span><span class="n">signal_t</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">penalty</span><span class="p">)</span>
        <span class="n">signals_aligned</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">signal_aligned</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">+=</span> <span class="n">signal_aligned</span><span class="o">.</span><span class="n">data</span>

    <span class="n">data</span> <span class="o">/=</span> <span class="n">k</span>

    <span class="k">for</span> <span class="n">signal_aligned</span> <span class="ow">in</span> <span class="n">signals_aligned</span><span class="p">:</span>

        <span class="n">variance</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">signal_aligned</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">variance</span> <span class="o">/=</span> <span class="n">k</span>

    <span class="n">template</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">signals_aligned</span><span class="p">,</span>
                   <span class="n">signal_t</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">signal_t</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="n">signal_t</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">template</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalTemplate.load_from_file">

<code class="highlight language-python"><span class="n">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>General interface to load the template from a file.</p>
<p><strong>NOTE</strong>: This is only for internal usage. If an FMSignalLeap object is
needed, use the class method "construct_from_file()" instead.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fn</code></td>
<td><code>string</code></td>
<td>
<p>The file name (without the ".csv" or ".npy" extension).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>string</code></td>
<td>
<p>The file format, either "raw_csv", or "raw_npy".</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>if the "mode" is unknown.</p>
</td>
</tr>
<tr>
<td><code>FileNotFoundError</code></td>
<td>
<p>if the file does not exist.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">"""General interface to load the template from a file.</span>

<span class="sd">    **NOTE**: This is only for internal usage. If an FMSignalLeap object is</span>
<span class="sd">    needed, use the class method "construct_from_file()" instead.</span>

<span class="sd">    Args:</span>

<span class="sd">        fn (string): The file name (without the ".csv" or ".npy" extension).</span>
<span class="sd">        mode (string): The file format, either "raw_csv", or "raw_npy".</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: if the "mode" is unknown.</span>
<span class="sd">        FileNotFoundError: if the file does not exist.</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"csv"</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".csv"</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">37</span>

        <span class="n">l</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">18</span>

        <span class="n">ts</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">data_and_variance</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">data_and_variance</span><span class="p">[:,</span> <span class="p">:</span><span class="n">d</span><span class="p">]</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="n">data_and_variance</span><span class="p">[:,</span> <span class="n">d</span><span class="p">:]</span>

    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"npy"</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".npy"</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
        <span class="k">assert</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">37</span>

        <span class="n">l</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">18</span>

        <span class="n">ts</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown file mode </span><span class="si">%s</span><span class="s2">!"</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">18</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">l</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">d</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="n">variance</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalTemplate.save_to_file">

<code class="highlight language-python"><span class="n">save_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>General interface to save the template to a file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fn</code></td>
<td><code>string</code></td>
<td>
<p>The file name (without the ".csv" or ".npy" extension).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>string</code></td>
<td>
<p>The file format, either "raw_csv", or "raw_npy".</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">save_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">"""General interface to save the template to a file.</span>

<span class="sd">    Args:</span>

<span class="sd">        fn (string): The file name (without the ".csv" or ".npy" extension).</span>
<span class="sd">        mode (string): The file format, either "raw_csv", or "raw_npy".</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    """</span>

    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="n">array_tup</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">)</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">array_tup</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"csv"</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">+=</span> <span class="s2">".csv"</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">"</span><span class="si">%.6f</span><span class="s2">"</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">", "</span><span class="p">)</span>


    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"npy"</span><span class="p">:</span>

        <span class="k">assert</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
        <span class="c1"># NOTE: NumPy library add the ".npy" file extension for us!</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown file mode </span><span class="si">%s</span><span class="s2">!"</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="fmsignal.FMSignalTemplate.update">

<code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_signal</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Update the template with a new signal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>new_signal</code></td>
<td><code>FMSignal</code></td>
<td>
<p>The new signal S used to update the template.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>factor</code></td>
<td><code>float</code></td>
<td>
<p>The update factor, 
            i.e., T_{new} = (1-factor)<em>T_{old} + S</em>factor.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>None</code></td>
<td>
<p>No return value.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>NOTE</strong>: The "new_signal" must be already aligned to the template.</p>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_signal</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
    <span class="sd">"""Update the template with a new signal.</span>

<span class="sd">    Args:</span>

<span class="sd">        new_signal (FMSignal): The new signal S used to update the template.</span>
<span class="sd">        factor (float): The update factor, </span>
<span class="sd">                        i.e., T_{new} = (1-factor)*T_{old} + S*factor.</span>

<span class="sd">    Returns:</span>

<span class="sd">        None: No return value.</span>

<span class="sd">    **NOTE**: The "new_signal" must be already aligned to the template.</span>

<span class="sd">    """</span>

    <span class="c1"># update the signal template</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">factor</span><span class="p">)</span> <span class="o">+</span> <span class="n">new_signal</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">factor</span>
</code></pre>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="fmsignal.dtw">

<code class="highlight language-python"><span class="n">dtw</span><span class="p">(</span><span class="n">series_1</span><span class="p">,</span> <span class="n">series_2</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


      </h2>
<div class="doc doc-contents ">
<p>Dynamic Time Warping (DTW) on two multidimensional time series.</p>
<p><strong>SEE</strong>:
<a href="https://en.wikipedia.org/wiki/Dynamic_time_warping">Dynamic Time Warping</a></p>
<p><strong>NOTE</strong>: This is the python implementation. It iteratively accesses each
element of the time series array, which could be very slow.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>series_1</code></td>
<td><code>ndarray</code></td>
<td>
<p>The first array, n-by-d numpy ndarray.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>series_2</code></td>
<td><code>ndarray</code></td>
<td>
<p>The second array, m-by-d numpy ndarray.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>window</code></td>
<td><code>int</code></td>
<td>
<p>The window constraint, by default no constraint.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>penalty</code></td>
<td><code>float</code></td>
<td>
<p>The misalign penalty, by default zero.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tuple</code></td>
<td>
<p>A tuple containing the following.</p>
<div class="highlight">
<pre><span></span><code>int: The final DTW distance.
ndarray: The (n + 1)-by-(m + 1) distance matrix.
ndarray: The (n + 1)-by-(m + 1) direction matrix (warp path).
ndarray: The alignment starting indices from 2 to 1.
ndarray: The alignment ending indices from 2 to 1.
ndarray: The alignment starting indices from 1 to 2.
ndarray: The alignment ending indices from 1 to 2.
ndarray: The generated time series by aligning 2 to 1.
</code></pre>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the input series have incompatible dimensions.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dtw</span><span class="p">(</span><span class="n">series_1</span><span class="p">,</span> <span class="n">series_2</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Dynamic Time Warping (DTW) on two multidimensional time series.</span>

<span class="sd">    **SEE**:</span>
<span class="sd">    [Dynamic Time Warping](https://en.wikipedia.org/wiki/Dynamic_time_warping)</span>

<span class="sd">    **NOTE**: This is the python implementation. It iteratively accesses each</span>
<span class="sd">    element of the time series array, which could be very slow.</span>

<span class="sd">    Args:</span>

<span class="sd">        series_1 (ndarray): The first array, n-by-d numpy ndarray.</span>
<span class="sd">        series_2 (ndarray): The second array, m-by-d numpy ndarray.</span>
<span class="sd">        window (int): The window constraint, by default no constraint.</span>
<span class="sd">        penalty (float): The misalign penalty, by default zero.</span>

<span class="sd">    Returns:</span>

<span class="sd">        tuple: A tuple containing the following.</span>

<span class="sd">            int: The final DTW distance.</span>
<span class="sd">            ndarray: The (n + 1)-by-(m + 1) distance matrix.</span>
<span class="sd">            ndarray: The (n + 1)-by-(m + 1) direction matrix (warp path).</span>
<span class="sd">            ndarray: The alignment starting indices from 2 to 1.</span>
<span class="sd">            ndarray: The alignment ending indices from 2 to 1.</span>
<span class="sd">            ndarray: The alignment starting indices from 1 to 2.</span>
<span class="sd">            ndarray: The alignment ending indices from 1 to 2.</span>
<span class="sd">            ndarray: The generated time series by aligning 2 to 1.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the input series have incompatible dimensions.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">series_1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> \
        <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">series_2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> \
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">series_1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">series_2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> \
        <span class="ow">or</span> <span class="n">series_1</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span> <span class="ow">or</span> <span class="n">series_2</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Input series must be l-by-d NumPy ndarrays!'</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">series_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">series_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">d1</span> <span class="o">=</span> <span class="n">series_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">series_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">d1</span> <span class="o">!=</span> <span class="n">d2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Input series must have the same dimension!'</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">series_1</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span> <span class="ow">or</span> <span class="n">series_2</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Input series must have "dtype == np.float32"!'</span><span class="p">)</span>

    <span class="c1"># NOTE: By default, the window is set to a sufficiently large value (m * 2)</span>
    <span class="c1"># to essentially remove the window constraint.</span>
    <span class="k">if</span> <span class="n">window</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">window</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="c1"># These are the distance matrix and the direction table.</span>
    <span class="n">dist_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="c1"># These are the index mapping to align series_2 to series_1.</span>
    <span class="n">a2to1_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">a2to1_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="c1"># These are the index mapping to align series_1 to series_2.</span>
    <span class="n">a1to2_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">a1to2_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="c1"># Initialization.</span>
    <span class="n">dist_matrix</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span>

    <span class="n">dist_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">#dist_matrix[:, 0] = 0</span>
    <span class="c1">#dist_matrix[0, :] = 0</span>


    <span class="c1"># find the warping path</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>

        <span class="n">jj</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">jj</span> <span class="o">-</span> <span class="n">window</span> <span class="k">if</span> <span class="n">jj</span> <span class="o">-</span> <span class="n">window</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">jj</span> <span class="o">+</span> <span class="n">window</span> <span class="k">if</span> <span class="n">jj</span> <span class="o">+</span> <span class="n">window</span> <span class="o">&lt;</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>

            <span class="c1"># CAUTION: series_1[0] and series_2[0] mapps to dists[1][1],</span>
            <span class="c1"># and i, j here are indexing dists instead of the series,</span>
            <span class="c1"># i.e., dists[i][j] is comparing series_1[i - 1] and series_2[j - 1]</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">series_1</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">series_2</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>

            <span class="n">min_dist</span> <span class="o">=</span> <span class="n">dist_matrix</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 1 stands for diagonal</span>

            <span class="k">if</span> <span class="n">dist_matrix</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">penalty</span> <span class="o">&lt;</span> <span class="n">min_dist</span><span class="p">:</span>

                <span class="n">min_dist</span> <span class="o">=</span> <span class="n">dist_matrix</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">penalty</span>
                <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># 2 stands for the i direction</span>

            <span class="k">if</span> <span class="n">dist_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">penalty</span> <span class="o">&lt;</span> <span class="n">min_dist</span><span class="p">:</span>

                <span class="n">min_dist</span> <span class="o">=</span> <span class="n">dist_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">penalty</span>
                <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># 4 stands for the j direction</span>

            <span class="n">dist_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">+</span> <span class="n">min_dist</span>

    <span class="c1"># trace back the warping path to find element-wise mapping</span>

    <span class="c1"># print('warping path done')</span>

    <span class="n">a2to1_start</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">a2to1_end</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">a1to2_start</span><span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">a1to2_end</span><span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">i</span> <span class="o">=</span> <span class="n">n</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">m</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># the i direction</span>

            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="n">a2to1_start</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">a2to1_end</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">a1to2_start</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># the j direction</span>

            <span class="n">j</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="n">a1to2_start</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">a1to2_end</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">a2to1_start</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># the diagonal direction</span>

            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">j</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">a2to1_start</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">a2to1_end</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">a1to2_start</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">a1to2_end</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># direction[i][j] == 0, the corner</span>
            <span class="k">break</span>

    <span class="n">series_2to1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">series_1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">series_1</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">a2to1_start</span><span class="p">,</span> <span class="n">a2to1_end</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">jj</span> <span class="o">==</span> <span class="n">kk</span><span class="p">:</span>

            <span class="n">series_2to1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">series_2</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">series_2to1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">series_2</span><span class="p">[</span><span class="n">jj</span> <span class="p">:</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dist_matrix</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">],</span> <span class="n">dist_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">direction</span><span class="p">,</span> \
           <span class="n">a2to1_start</span><span class="p">,</span> <span class="n">a2to1_end</span><span class="p">,</span> <span class="n">a1to2_start</span><span class="p">,</span> <span class="n">a1to2_end</span><span class="p">,</span> <span class="n">series_2to1</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="fmsignal.dtw_c">

<code class="highlight language-python"><span class="n">dtw_c</span><span class="p">(</span><span class="n">series_1</span><span class="p">,</span> <span class="n">series_2</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


      </h2>
<div class="doc doc-contents ">
<p>Python wrapper of the Dynamic Time Warping (DTW) implemented in C.</p>
<p><strong>SEE</strong>:
<a href="https://en.wikipedia.org/wiki/Dynamic_time_warping">Dynamic Time Warping</a></p>
<p><strong>SEE</strong>: The "fmkit_cutils" package in this project has the implementation.</p>
<p><strong>NOTE</strong>: This is a Python wrapper of the C implementation, which is
relative fast compared to the pure Python implementation.</p>
<p><strong>NOTE</strong>: The input series must have "dtype == np.float32".</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>series_1</code></td>
<td><code>ndarray</code></td>
<td>
<p>The first array, n-by-d numpy ndarray.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>series_2</code></td>
<td><code>ndarray</code></td>
<td>
<p>The second array, m-by-d numpy ndarray.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>window</code></td>
<td><code>int</code></td>
<td>
<p>The window constraint, by default no constraint.</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>penalty</code></td>
<td><code>float</code></td>
<td>
<p>The misalign penalty, by default zero.</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tuple</code></td>
<td>
<p>A tuple containing the following.</p>
<div class="highlight">
<pre><span></span><code>int: The final DTW distance.
ndarray: The (n + 1)-by-(m + 1) distance matrix.
ndarray: The (n + 1)-by-(m + 1) direction matrix (warp path).
ndarray: The alignment starting indices from 2 to 1.
ndarray: The alignment ending indices from 2 to 1.
ndarray: The alignment starting indices from 1 to 2.
ndarray: The alignment ending indices from 1 to 2.
ndarray: The generated time series by aligning 2 to 1.
</code></pre>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the input series have incompatible dimensions.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dtw_c</span><span class="p">(</span><span class="n">series_1</span><span class="p">,</span> <span class="n">series_2</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Python wrapper of the Dynamic Time Warping (DTW) implemented in C.</span>

<span class="sd">    **SEE**:</span>
<span class="sd">    [Dynamic Time Warping](https://en.wikipedia.org/wiki/Dynamic_time_warping)</span>

<span class="sd">    **SEE**: The "fmkit_cutils" package in this project has the implementation.</span>

<span class="sd">    **NOTE**: This is a Python wrapper of the C implementation, which is</span>
<span class="sd">    relative fast compared to the pure Python implementation.</span>

<span class="sd">    **NOTE**: The input series must have "dtype == np.float32".</span>

<span class="sd">    Args:</span>

<span class="sd">        series_1 (ndarray): The first array, n-by-d numpy ndarray.</span>
<span class="sd">        series_2 (ndarray): The second array, m-by-d numpy ndarray.</span>
<span class="sd">        window (int, optional): The window constraint, by default no constraint.</span>
<span class="sd">        penalty (float, optional): The misalign penalty, by default zero.</span>

<span class="sd">    Returns:</span>

<span class="sd">        tuple: A tuple containing the following.</span>

<span class="sd">            int: The final DTW distance.</span>
<span class="sd">            ndarray: The (n + 1)-by-(m + 1) distance matrix.</span>
<span class="sd">            ndarray: The (n + 1)-by-(m + 1) direction matrix (warp path).</span>
<span class="sd">            ndarray: The alignment starting indices from 2 to 1.</span>
<span class="sd">            ndarray: The alignment ending indices from 2 to 1.</span>
<span class="sd">            ndarray: The alignment starting indices from 1 to 2.</span>
<span class="sd">            ndarray: The alignment ending indices from 1 to 2.</span>
<span class="sd">            ndarray: The generated time series by aligning 2 to 1.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the input series have incompatible dimensions.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">series_1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> \
        <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">series_2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> \
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">series_1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">series_2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Input series must be l-by-d NumPy ndarrays!'</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">series_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">series_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">d1</span> <span class="o">=</span> <span class="n">series_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">series_2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">d1</span> <span class="o">!=</span> <span class="n">d2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Input series must have the same dimension!'</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">series_1</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span> <span class="ow">or</span> <span class="n">series_2</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Input series must have "dtype == np.float32"!'</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">window</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">window</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="c1"># print('begin dtw_c()')</span>

    <span class="c1"># NOTE: It may be problematic to manage the memory and Python object</span>
    <span class="c1"># life-cycle in C code, and hence, we allocate space here in the wrapper.</span>

    <span class="n">dist_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="c1"># These are the index mapping to align series_2 to series_1.</span>
    <span class="n">a2to1_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">a2to1_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="c1"># These are the index mapping to align series_1 to series_2.</span>
    <span class="n">a1to2_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">a1to2_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="n">series_2to1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">series_1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># Initialization.</span>
    <span class="n">dist_matrix</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span>

    <span class="n">dist</span> <span class="o">=</span> <span class="n">fmkit_utilities</span><span class="o">.</span><span class="n">dtw_c</span><span class="p">(</span>
        <span class="n">series_1</span><span class="p">,</span>
        <span class="n">series_2</span><span class="p">,</span>
        <span class="n">series_1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">n</span><span class="p">,</span>
        <span class="n">m</span><span class="p">,</span>
        <span class="n">window</span><span class="p">,</span>
        <span class="n">penalty</span><span class="p">,</span>
        <span class="n">dist_matrix</span><span class="p">,</span>
        <span class="n">direction</span><span class="p">,</span>
        <span class="n">a2to1_start</span><span class="p">,</span>
        <span class="n">a2to1_end</span><span class="p">,</span>
        <span class="n">a1to2_start</span><span class="p">,</span>
        <span class="n">a1to2_end</span><span class="p">,</span>
        <span class="n">series_2to1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># print('end dtw_c()')</span>

    <span class="k">return</span> <span class="n">dist</span><span class="p">,</span> <span class="n">dist_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">direction</span><span class="p">,</span> \
        <span class="n">a2to1_start</span><span class="p">,</span> <span class="n">a2to1_end</span><span class="p">,</span> <span class="n">a1to2_start</span><span class="p">,</span> <span class="n">a1to2_end</span><span class="p">,</span> <span class="n">series_2to1</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="fmsignal.normalize_warping_path_a2to1">

<code class="highlight language-python"><span class="n">normalize_warping_path_a2to1</span><span class="p">(</span><span class="n">a2to1_start</span><span class="p">,</span> <span class="n">a2to1_end</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>


      </h2>
<div class="doc doc-contents ">
<p>Normalize the warping path from l2-by-l1 to n-by-n.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>a2to1_start</code></td>
<td><code>ndarray</code></td>
<td>
<p>The alignment starting indices from 2 to 1.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>a2to1_end</code></td>
<td><code>ndarray</code></td>
<td>
<p>The alignment ending indices from 2 to 1.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>n</code></td>
<td><code>int</code></td>
<td>
<p>The size of the warping path after normalization.</p>
</td>
<td><code>100</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(ndarray)</code></td>
<td>
<p>The "a2to1_start" after normalization.
(ndarray): The "a2to1_end" after normalization.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the input arrays have wrong type or value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">normalize_warping_path_a2to1</span><span class="p">(</span><span class="n">a2to1_start</span><span class="p">,</span> <span class="n">a2to1_end</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sd">"""Normalize the warping path from l2-by-l1 to n-by-n.</span>

<span class="sd">    Args:</span>

<span class="sd">        a2to1_start (ndarray): The alignment starting indices from 2 to 1.</span>
<span class="sd">        a2to1_end (ndarray): The alignment ending indices from 2 to 1.</span>
<span class="sd">        n (int): The size of the warping path after normalization.</span>

<span class="sd">    Returns:</span>

<span class="sd">        (ndarray): The "a2to1_start" after normalization.</span>
<span class="sd">        (ndarray): The "a2to1_end" after normalization.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the input arrays have wrong type or value.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a2to1_start</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> \
        <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a2to1_end</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> \
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">a2to1_start</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">a2to1_end</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> \
        <span class="ow">or</span> <span class="n">a2to1_start</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span> <span class="ow">or</span> <span class="n">a2to1_end</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Input series must be two 1D NumPy arrays!'</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">a2to1_start</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">a2to1_end</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">a2to1_end</span> <span class="o">-</span> <span class="n">a2to1_start</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="n">l1</span> <span class="o">=</span> <span class="n">a2to1_start</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">a2to1_end</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span>
    <span class="n">x_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">l1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="n">a2to1_start_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">a2to1_start</span><span class="p">)</span>
    <span class="n">a2to1_start_n</span> <span class="o">=</span> <span class="n">a2to1_start_n</span> <span class="o">/</span> <span class="n">l2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">a2to1_end_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">a2to1_end</span><span class="p">)</span>
    <span class="n">a2to1_end_n</span> <span class="o">=</span> <span class="n">a2to1_end_n</span> <span class="o">/</span> <span class="n">l2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a2to1_start_n</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span> <span class="n">a2to1_end_n</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="fmsignal.warping_path_to_xy_sequences">

<code class="highlight language-python"><span class="n">warping_path_to_xy_sequences</span><span class="p">(</span><span class="n">a2to1_start</span><span class="p">,</span> <span class="n">a2to1_end</span><span class="p">)</span></code>


      </h2>
<div class="doc doc-contents ">
<p>Convert the warping path from alignment indices to xy coordinates.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>a2to1_start</code></td>
<td><code>ndarray</code></td>
<td>
<p>The alignment starting indices from 2 to 1.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>a2to1_end</code></td>
<td><code>ndarray</code></td>
<td>
<p>The alignment ending indices from 2 to 1.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(list)</code></td>
<td>
<p>The x coordinates.
(list): The y coordinates.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>If the input arrays have wrong type or value.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>code_fmkit/fmsignal.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">warping_path_to_xy_sequences</span><span class="p">(</span><span class="n">a2to1_start</span><span class="p">,</span> <span class="n">a2to1_end</span><span class="p">):</span>
    <span class="sd">"""Convert the warping path from alignment indices to xy coordinates.</span>

<span class="sd">    Args:</span>

<span class="sd">        a2to1_start (ndarray): The alignment starting indices from 2 to 1.</span>
<span class="sd">        a2to1_end (ndarray): The alignment ending indices from 2 to 1.</span>

<span class="sd">    Returns:</span>

<span class="sd">        (list): The x coordinates.</span>
<span class="sd">        (list): The y coordinates.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If the input arrays have wrong type or value.</span>


<span class="sd">    """</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a2to1_start</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> \
        <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a2to1_end</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> \
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">a2to1_start</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">a2to1_end</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> \
        <span class="ow">or</span> <span class="n">a2to1_start</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span> <span class="ow">or</span> <span class="n">a2to1_end</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Input series must be two 1D NumPy arrays!'</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">a2to1_start</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">a2to1_end</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">a2to1_end</span> <span class="o">-</span> <span class="n">a2to1_start</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">xs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">a2to1_start</span><span class="p">,</span> <span class="n">a2to1_end</span><span class="p">)):</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>

            <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

            <span class="c1">#print(i, j, start, end)</span>

    <span class="k">return</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span>
</code></pre>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../manual_signal/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                User Manual - Signal
              </div>
            </div>
          </a>
        
        
          <a href="../fmsignal_vis-reference/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                fmsignal_vis
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.53cc9318.min.js"></script>
      <script src="../assets/javascripts/bundle.e9c9f54f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>